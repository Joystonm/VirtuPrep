<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VirtuPrep - Soft Skills VR Trainer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            padding: 2rem;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        .header {
            text-align: center;
            margin-bottom: 4rem;
        }
        
        .logo {
            font-size: 4rem;
            font-weight: bold;
            margin-bottom: 1rem;
            background: rgba(255, 255, 255, 0.1);
            padding: 1.5rem 3rem;
            border-radius: 25px;
            display: inline-block;
            backdrop-filter: blur(10px);
        }
        
        .tagline {
            font-size: 1.5rem;
            opacity: 0.9;
            margin-bottom: 2rem;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.6;
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            margin-bottom: 4rem;
        }
        
        .feature-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 2.5rem;
            text-align: center;
            transition: all 0.4s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .feature-card:hover {
            transform: translateY(-10px) scale(1.02);
            border-color: rgba(255, 255, 255, 0.3);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }
        
        .feature-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            display: block;
        }
        
        .feature-title {
            font-size: 1.8rem;
            margin-bottom: 1rem;
            font-weight: bold;
        }
        
        .feature-description {
            opacity: 0.9;
            line-height: 1.7;
            margin-bottom: 1.5rem;
        }
        
        .nav-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3rem;
            padding: 1rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .back-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .module-content {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 3rem;
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .module-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }
        
        .module-feature {
            background: rgba(255, 255, 255, 0.1);
            padding: 1.5rem;
            border-radius: 15px;
            text-align: center;
        }
        
        .start-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 1rem 3rem;
            border-radius: 25px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 2rem;
        }
        
        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.4);
        }
        
        .cta-section {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 25px;
            padding: 4rem 2rem;
            margin: 4rem 0;
        }
        
        .cta-headline {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }
        
        .cta-subheading {
            font-size: 1.3rem;
            opacity: 0.9;
            margin-bottom: 3rem;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.6;
        }
        
        .cta-button {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 1.5rem 4rem;
            border-radius: 50px;
            font-size: 1.3rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s ease;
        }
        
        .cta-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(16, 185, 129, 0.4);
        }
        
        @media (max-width: 768px) {
            .features-grid {
                grid-template-columns: 1fr;
            }
            .cta-headline {
                font-size: 2rem;
            }
            .logo {
                font-size: 2.5rem;
                padding: 1rem 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Landing Page -->
        <div id="landing" class="page active">
            <div class="header">
                <div class="logo">üéØ VirtuPrep</div>
                <h1 style="font-size: 2.5rem; margin-bottom: 1rem;">Master Your Soft Skills in VR</h1>
                <p class="tagline">
                    An interactive, browser-based VR platform for mastering soft skills through immersive 3D environments, 
                    real-time feedback, and AI-powered coaching.
                </p>
            </div>
            
            <div class="features-grid">
                <div class="feature-card" onclick="goToModule('public-speaking')">
                    <span class="feature-icon">üé§</span>
                    <h3 class="feature-title">Public Speaking</h3>
                    <p class="feature-description">
                        Practice in an immersive auditorium with realistic audience animations, live speech analysis, 
                        and dynamic crowd reactions to build confidence and presentation skills.
                    </p>
                </div>
                
                <div class="feature-card" onclick="goToModule('team-leadership')">
                    <span class="feature-icon">üë•</span>
                    <h3 class="feature-title">Team Leadership</h3>
                    <p class="feature-description">
                        Lead virtual meetings with AI-driven avatars, make decisions through branching dialogues, 
                        and track your leadership effectiveness in real-time.
                    </p>
                </div>
                
                <div class="feature-card" onclick="goToModule('collaboration')">
                    <span class="feature-icon">ü§ù</span>
                    <h3 class="feature-title">Collaboration</h3>
                    <p class="feature-description">
                        Work with AI teammates using virtual whiteboards, sticky notes, and project dashboards. 
                        Build consensus and negotiate under time pressure.
                    </p>
                </div>
                
                <div class="feature-card" onclick="goToModule('analytics')">
                    <span class="feature-icon">üìä</span>
                    <h3 class="feature-title">Real-time Analytics</h3>
                    <p class="feature-description">
                        Track speech metrics, filler words, volume, and sentiment with live dashboards, 
                        color-coded feedback, and detailed improvement reports.
                    </p>
                </div>
                
                <div class="feature-card" onclick="goToModule('vr-experience')">
                    <span class="feature-icon">ü•Ω</span>
                    <h3 class="feature-title">VR Experience</h3>
                    <p class="feature-description">
                        Seamless WebXR integration supporting both desktop and VR headsets with smooth environment 
                        transitions, immersive audio, and free-look camera control.
                    </p>
                </div>
                
                <div class="feature-card" onclick="goToModule('challenges')">
                    <span class="feature-icon">üéØ</span>
                    <h3 class="feature-title">Interactive Challenges</h3>
                    <p class="feature-description">
                        Face unpredictable events like audience questions, technical failures, and team conflicts. 
                        Make quick decisions and earn achievement badges.
                    </p>
                </div>
            </div>
            
            <div class="cta-section">
                <h2 class="cta-headline">Ready to Master Your Soft Skills?</h2>
                <p class="cta-subheading">
                    Join thousands of professionals who have improved their communication and leadership skills with VirtuPrep.
                </p>
                <button class="cta-button" onclick="goToModule('public-speaking')">Start Your VR Training Journey</button>
            </div>
        </div>
        
        <!-- Public Speaking Module -->
        <div id="public-speaking" class="page">
            <div class="nav-header">
                <button class="back-btn" onclick="goToModule('landing')">‚Üê Back to Home</button>
                <h2>üé§ Public Speaking Training</h2>
            </div>
            
            <div class="module-content">
                <h3 style="font-size: 2rem; margin-bottom: 2rem;">üèõÔ∏è Virtual Auditorium</h3>
                <p style="font-size: 1.2rem; margin-bottom: 2rem;">
                    Welcome to your immersive public speaking training environment!
                </p>
                
                <div class="module-features">
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üë•</div>
                        <h4>Realistic Audience</h4>
                        <p>Interactive audience members with dynamic reactions</p>
                    </div>
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üìä</div>
                        <h4>Live Analytics</h4>
                        <p>Real-time speech analysis and feedback</p>
                    </div>
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üé§</div>
                        <h4>Voice Analysis</h4>
                        <p>Track clarity, pace, and volume in real-time</p>
                    </div>
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">‚ö°</div>
                        <h4>Interactive Challenges</h4>
                        <p>Handle unexpected questions and situations</p>
                    </div>
                </div>
                
                <button class="start-btn" onclick="startTraining('public-speaking')">üé§ Start Public Speaking Training</button>
            </div>
        </div>
        
        <!-- Team Leadership Module -->
        <div id="team-leadership" class="page">
            <div class="nav-header">
                <button class="back-btn" onclick="goToModule('landing')">‚Üê Back to Home</button>
                <h2>üë• Team Leadership Training</h2>
            </div>
            
            <div class="module-content">
                <h3 style="font-size: 2rem; margin-bottom: 2rem;">üè¢ Virtual Meeting Room</h3>
                <p style="font-size: 1.2rem; margin-bottom: 2rem;">
                    Lead your virtual team through challenging scenarios and decisions!
                </p>
                
                <div class="module-features">
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">ü§ñ</div>
                        <h4>AI Team Members</h4>
                        <p>Interact with intelligent virtual team members</p>
                    </div>
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üéØ</div>
                        <h4>Decision Making</h4>
                        <p>Practice making tough leadership decisions</p>
                    </div>
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">‚öñÔ∏è</div>
                        <h4>Conflict Resolution</h4>
                        <p>Navigate team disagreements diplomatically</p>
                    </div>
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üí™</div>
                        <h4>Team Motivation</h4>
                        <p>Learn to inspire and motivate your team</p>
                    </div>
                </div>
                
                <button class="start-btn" onclick="startTraining('team-leadership')">üë• Start Leadership Training</button>
            </div>
        </div>
        
        <!-- Collaboration Module -->
        <div id="collaboration" class="page">
            <div class="nav-header">
                <button class="back-btn" onclick="goToModule('landing')">‚Üê Back to Home</button>
                <h2>ü§ù Collaboration Training</h2>
            </div>
            
            <div class="module-content">
                <h3 style="font-size: 2rem; margin-bottom: 2rem;">üõ†Ô∏è Virtual Workspace</h3>
                <p style="font-size: 1.2rem; margin-bottom: 2rem;">
                    Collaborate with AI teammates using interactive tools and build consensus!
                </p>
                
                <div class="module-features">
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üñäÔ∏è</div>
                        <h4>Virtual Whiteboard</h4>
                        <p>Brainstorm and sketch ideas collaboratively</p>
                    </div>
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üìù</div>
                        <h4>Sticky Notes</h4>
                        <p>Organize thoughts and facilitate voting</p>
                    </div>
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üó≥Ô∏è</div>
                        <h4>Consensus Building</h4>
                        <p>Practice building team agreement</p>
                    </div>
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">‚è∞</div>
                        <h4>Time Pressure</h4>
                        <p>Make decisions under tight deadlines</p>
                    </div>
                </div>
                
                <button class="start-btn" onclick="startTraining('collaboration')">ü§ù Start Collaboration Training</button>
            </div>
        </div>
        
        <!-- Analytics Module -->
        <div id="analytics" class="page">
            <div class="nav-header">
                <button class="back-btn" onclick="goToModule('landing')">‚Üê Back to Home</button>
                <h2>üìä Real-time Analytics</h2>
            </div>
            
            <div class="module-content">
                <h3 style="font-size: 2rem; margin-bottom: 2rem;">üìà Performance Dashboard</h3>
                <p style="font-size: 1.2rem; margin-bottom: 2rem;">
                    Track your speaking performance with advanced analytics and insights!
                </p>
                
                <div class="module-features">
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üó£Ô∏è</div>
                        <h4>Speech Metrics</h4>
                        <p>Words per minute, clarity, and volume analysis</p>
                    </div>
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üö´</div>
                        <h4>Filler Word Detection</h4>
                        <p>Track and reduce "um", "uh", and other fillers</p>
                    </div>
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üòä</div>
                        <h4>Sentiment Analysis</h4>
                        <p>Analyze the emotional tone of your speech</p>
                    </div>
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üìã</div>
                        <h4>Detailed Reports</h4>
                        <p>Comprehensive performance reports with tips</p>
                    </div>
                </div>
                
                <button class="start-btn" onclick="startTraining('analytics')">üìä Start Analytics Demo</button>
            </div>
        </div>
        
        <!-- VR Experience Module -->
        <div id="vr-experience" class="page">
            <div class="nav-header">
                <button class="back-btn" onclick="goToModule('landing')">‚Üê Back to Home</button>
                <h2>ü•Ω VR Experience</h2>
            </div>
            
            <div class="module-content">
                <h3 style="font-size: 2rem; margin-bottom: 2rem;">üåê Immersive Environments</h3>
                <p style="font-size: 1.2rem; margin-bottom: 2rem;">
                    Experience cutting-edge VR technology with WebXR support!
                </p>
                
                <div class="module-features">
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">ü•Ω</div>
                        <h4>WebXR Support</h4>
                        <p>Compatible with VR headsets and desktop browsers</p>
                    </div>
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üèõÔ∏è</div>
                        <h4>Multiple Environments</h4>
                        <p>Auditorium, meeting room, and workshop spaces</p>
                    </div>
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üîä</div>
                        <h4>Immersive Audio</h4>
                        <p>3D spatial audio for realistic experiences</p>
                    </div>
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üéÆ</div>
                        <h4>Free-look Control</h4>
                        <p>Natural head tracking and movement</p>
                    </div>
                </div>
                
                <button class="start-btn" onclick="startTraining('vr-experience')">ü•Ω Experience VR Demo</button>
            </div>
        </div>
        
        <!-- Challenges Module -->
        <div id="challenges" class="page">
            <div class="nav-header">
                <button class="back-btn" onclick="goToModule('landing')">‚Üê Back to Home</button>
                <h2>üéØ Interactive Challenges</h2>
            </div>
            
            <div class="module-content">
                <h3 style="font-size: 2rem; margin-bottom: 2rem;">‚ö° Challenge Arena</h3>
                <p style="font-size: 1.2rem; margin-bottom: 2rem;">
                    Face unexpected situations and test your quick thinking skills!
                </p>
                
                <div class="module-features">
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">‚ùì</div>
                        <h4>Unexpected Events</h4>
                        <p>Handle surprise questions and interruptions</p>
                    </div>
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">‚è∞</div>
                        <h4>Time Pressure</h4>
                        <p>Make quick decisions under tight deadlines</p>
                    </div>
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üé≠</div>
                        <h4>Adaptive Scenarios</h4>
                        <p>Dynamic situations that change based on your responses</p>
                    </div>
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üèÜ</div>
                        <h4>Achievement System</h4>
                        <p>Earn badges and track your progress</p>
                    </div>
                </div>
                
                <button class="start-btn" onclick="startTraining('challenges')">üéØ Start Challenge Training</button>
            </div>
        </div>
        
        <!-- Analytics Module -->
        <div id="analytics" class="page">
            <div class="nav-header">
                <button class="back-btn" onclick="goToModule('landing')">‚Üê Back to Home</button>
                <h2>üìä Real-time Analytics</h2>
            </div>
            
            <div class="module-content">
                <h3 style="font-size: 2rem; margin-bottom: 2rem;">üìà Performance Dashboard</h3>
                <p style="font-size: 1.2rem; margin-bottom: 2rem;">
                    Track your speaking performance with advanced analytics and insights!
                </p>
                
                <div class="module-features">
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üó£Ô∏è</div>
                        <h4>Speech Metrics</h4>
                        <p>Words per minute, clarity, and volume analysis</p>
                    </div>
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üö´</div>
                        <h4>Filler Word Detection</h4>
                        <p>Track and reduce "um", "uh", and other fillers</p>
                    </div>
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üòä</div>
                        <h4>Sentiment Analysis</h4>
                        <p>Analyze the emotional tone of your speech</p>
                    </div>
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üìã</div>
                        <h4>Detailed Reports</h4>
                        <p>Comprehensive performance reports with tips</p>
                    </div>
                </div>
                
                <button class="start-btn" onclick="startTraining('analytics')">üìä Start Analytics Demo</button>
            </div>
        </div>
        
        <!-- VR Experience Module -->
        <div id="vr-experience" class="page">
            <div class="nav-header">
                <button class="back-btn" onclick="goToModule('landing')">‚Üê Back to Home</button>
                <h2>ü•Ω VR Experience</h2>
            </div>
            
            <div class="module-content">
                <h3 style="font-size: 2rem; margin-bottom: 2rem;">üåê Immersive Environments</h3>
                <p style="font-size: 1.2rem; margin-bottom: 2rem;">
                    Experience cutting-edge VR technology with WebXR support!
                </p>
                
                <div class="module-features">
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">ü•Ω</div>
                        <h4>WebXR Support</h4>
                        <p>Compatible with VR headsets and desktop browsers</p>
                    </div>
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üèõÔ∏è</div>
                        <h4>Multiple Environments</h4>
                        <p>Auditorium, meeting room, and workshop spaces</p>
                    </div>
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üîä</div>
                        <h4>Immersive Audio</h4>
                        <p>3D spatial audio for realistic experiences</p>
                    </div>
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üéÆ</div>
                        <h4>Free-look Control</h4>
                        <p>Natural head tracking and movement</p>
                    </div>
                </div>
                
                <button class="start-btn" onclick="startTraining('vr-experience')">ü•Ω Experience VR Demo</button>
            </div>
        </div>
        
        <!-- Challenges Module -->
        <div id="challenges" class="page">
            <div class="nav-header">
                <button class="back-btn" onclick="goToModule('landing')">‚Üê Back to Home</button>
                <h2>üéØ Interactive Challenges</h2>
            </div>
            
            <div class="module-content">
                <h3 style="font-size: 2rem; margin-bottom: 2rem;">‚ö° Challenge Arena</h3>
                <p style="font-size: 1.2rem; margin-bottom: 2rem;">
                    Face unexpected situations and test your quick thinking skills!
                </p>
                
                <div class="module-features">
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">‚ùì</div>
                        <h4>Unexpected Events</h4>
                        <p>Handle surprise questions and interruptions</p>
                    </div>
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">‚è∞</div>
                        <h4>Time Pressure</h4>
                        <p>Make quick decisions under tight deadlines</p>
                    </div>
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üé≠</div>
                        <h4>Adaptive Scenarios</h4>
                        <p>Dynamic situations that change based on your responses</p>
                    </div>
                    <div class="module-feature">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üèÜ</div>
                        <h4>Achievement System</h4>
                        <p>Earn badges and track your progress</p>
                    </div>
                </div>
                
            </div>
        </div>
        
        <!-- Public Speaking Training Interface -->
        <div id="public-speaking-training" class="page">
            <div class="nav-header">
                <button class="back-btn" onclick="goToModule('public-speaking')">‚Üê Back to Module</button>
                <h2>üé§ Public Speaking Training - AI-Powered Session</h2>
                <button class="back-btn" onclick="goToModule('landing')">üè† Home</button>
            </div>
            
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                <!-- VR Environment -->
                <div style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border-radius: 20px; padding: 2rem; min-height: 500px; position: relative;">
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <h3 style="font-size: 1.5rem; margin-bottom: 1rem;">üèõÔ∏è AI-Powered Virtual Auditorium</h3>
                        <p style="opacity: 0.8;">Groq AI is listening and will ask you questions about your speech</p>
                    </div>
                    
                    <!-- Virtual Stage -->
                    <div style="background: rgba(139, 69, 19, 0.3); height: 60px; width: 200px; margin: 2rem auto; border-radius: 10px; display: flex; align-items: center; justify-content: center; position: relative;">
                        <span style="font-size: 2rem;">üé§</span>
                        <div style="position: absolute; top: -30px; font-size: 0.8rem; opacity: 0.8;">Your Position</div>
                    </div>
                    
                    <!-- Current Topic Display -->
                    <div style="background: rgba(255,255,255,0.1); padding: 1.5rem; border-radius: 15px; margin: 2rem 0; text-align: center;">
                        <h4 style="margin-bottom: 1rem;">üéØ Current Speaking Topic:</h4>
                        <p id="current-topic" style="font-size: 1.1rem; font-weight: bold; color: #10b981;">Click "Get Random Topic" to receive an AI-generated speaking challenge</p>
                        <div style="margin-top: 1rem;">
                            <button class="start-btn" onclick="getRandomTopic()" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); padding: 0.5rem 1.5rem; font-size: 0.9rem;">
                                üé≤ Get Random Topic
                            </button>
                        </div>
                    </div>
                    
                    <!-- Audience Grid -->
                    <div id="audience-grid" style="display: grid; grid-template-columns: repeat(8, 1fr); gap: 8px; margin-top: 2rem;">
                        <!-- Audience members will be generated by JavaScript -->
                    </div>
                    
                    <!-- AI Feedback -->
                    <div style="position: absolute; bottom: 1rem; left: 1rem; right: 1rem; background: rgba(0,0,0,0.8); padding: 1rem; border-radius: 10px; border: 2px solid #10b981;">
                        <div style="display: flex; align-items: center; margin-bottom: 0.5rem;">
                            <span style="font-size: 1.2rem; margin-right: 0.5rem;">ü§ñ</span>
                            <strong>Groq AI Coach:</strong>
                        </div>
                        <div id="ai-feedback" style="font-size: 0.85rem; opacity: 0.9; line-height: 1.4;">Welcome! I'm your AI speaking coach. I'll listen to your speech, ask relevant questions, and provide personalized feedback. Click "Start Speaking" to begin!</div>
                    </div>
                </div>
                
                <!-- Analytics & AI Panel -->
                <div style="background: rgba(0,0,0,0.8); border-radius: 20px; padding: 1.5rem;">
                    <h4 style="margin-bottom: 1rem; text-align: center;">üìä Live Analytics</h4>
                    
                    <div style="margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span>üó£Ô∏è Speech Clarity</span>
                            <span id="clarity-score">0%</span>
                        </div>
                        <div style="background: rgba(255,255,255,0.2); height: 8px; border-radius: 4px; overflow: hidden;">
                            <div id="clarity-bar" style="background: linear-gradient(90deg, #10b981, #059669); height: 100%; width: 0%; transition: width 0.5s ease;"></div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span>üîä Volume Level</span>
                            <span id="volume-score">0%</span>
                        </div>
                        <div style="background: rgba(255,255,255,0.2); height: 8px; border-radius: 4px; overflow: hidden;">
                            <div id="volume-bar" style="background: linear-gradient(90deg, #3b82f6, #1d4ed8); height: 100%; width: 0%; transition: width 0.5s ease;"></div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span>‚ö° Speaking Pace</span>
                            <span id="pace-score">0 WPM</span>
                        </div>
                        <div style="background: rgba(255,255,255,0.2); height: 8px; border-radius: 4px; overflow: hidden;">
                            <div id="pace-bar" style="background: linear-gradient(90deg, #f59e0b, #d97706); height: 100%; width: 0%; transition: width 0.5s ease;"></div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span>üéØ Engagement</span>
                            <span id="engagement-score">0%</span>
                        </div>
                        <div style="background: rgba(255,255,255,0.2); height: 8px; border-radius: 4px; overflow: hidden;">
                            <div id="engagement-bar" style="background: linear-gradient(90deg, #8b5cf6, #7c3aed); height: 100%; width: 0%; transition: width 0.5s ease;"></div>
                        </div>
                    </div>
                    
                    <!-- AI Conversation Panel -->
                    <div style="margin-top: 2rem; padding: 1rem; background: rgba(16, 185, 129, 0.1); border-radius: 10px; border: 1px solid rgba(16, 185, 129, 0.3);">
                        <h5 style="margin-bottom: 1rem; display: flex; align-items: center;">
                            <span style="margin-right: 0.5rem;">ü§ñ</span>
                            AI Conversation
                        </h5>
                        <div id="ai-conversation" style="max-height: 200px; overflow-y: auto; font-size: 0.8rem; line-height: 1.4;">
                            <div style="opacity: 0.7; font-style: italic;">AI will start asking questions once you begin speaking...</div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 1.5rem; padding: 1rem; background: rgba(255,255,255,0.1); border-radius: 10px;">
                        <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem;">‚è±Ô∏è</div>
                        <div>Session Time</div>
                        <div id="session-time" style="font-size: 1.2rem; font-weight: bold;">00:00</div>
                    </div>
                </div>
            </div>
            
            <!-- Training Controls -->
            <div style="display: flex; justify-content: center; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap;">
                <button id="speak-btn" class="start-btn" onclick="startSpeaking()" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                    üé§ Start Speaking
                </button>
                <button class="start-btn" onclick="showTopicGenerator()" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                    üé≤ Smart Topics
                </button>
                <button class="start-btn" onclick="getAIFeedback()" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                    üí° Get AI Feedback
                </button>
                <button class="start-btn" onclick="showResults()" style="background: linear-gradient(135deg, #059669 0%, #047857 100%);">
                    üìä View Results
                </button>
            </div>
            
            <!-- Groq API Key Input (Hidden by default) -->
            <div id="api-key-section" style="background: rgba(255,255,255,0.1); padding: 2rem; border-radius: 15px; margin-bottom: 2rem; text-align: center;">
                <h4 style="margin-bottom: 1rem;">üîë Groq API Configuration</h4>
                <p style="opacity: 0.8; margin-bottom: 1rem;">To enable AI features, you need a free Groq API key. Get one at <a href="https://console.groq.com" target="_blank" style="color: #10b981;">console.groq.com</a></p>
                <div style="display: flex; gap: 1rem; justify-content: center; align-items: center; flex-wrap: wrap;">
                    <input type="password" id="groq-api-key" placeholder="Enter your Groq API key" style="
                        background: rgba(255,255,255,0.1);
                        border: 1px solid rgba(255,255,255,0.3);
                        color: white;
                        padding: 0.75rem 1rem;
                        border-radius: 10px;
                        width: 300px;
                        font-size: 0.9rem;
                    ">
                    <button onclick="saveApiKey()" style="
                        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                        color: white;
                        border: none;
                        padding: 0.75rem 1.5rem;
                        border-radius: 10px;
                        cursor: pointer;
                        font-weight: 600;
                    ">Save Key</button>
                </div>
                <p style="font-size: 0.8rem; opacity: 0.7; margin-top: 1rem;">Your API key is stored locally and never shared. It's only used to communicate with Groq AI.</p>
            </div>
        </div>
        
        <!-- Team Leadership Training Interface -->
        <div id="team-leadership-training" class="page">
            <div class="nav-header">
                <button class="back-btn" onclick="goToModule('team-leadership')">‚Üê Back to Module</button>
                <h2>üë• Team Leadership Training - Live Session</h2>
                <button class="back-btn" onclick="goToModule('landing')">üè† Home</button>
            </div>
            
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                <!-- VR Meeting Room -->
                <div style="background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%); border-radius: 20px; padding: 2rem; min-height: 500px; position: relative;">
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <h3 style="font-size: 1.5rem; margin-bottom: 1rem;">üè¢ Virtual Meeting Room</h3>
                        <p style="opacity: 0.8;">You are leading a team meeting with AI-driven team members</p>
                    </div>
                    
                    <!-- Conference Table -->
                    <div style="width: 300px; height: 150px; background: linear-gradient(135deg, #8B4513 0%, #654321 100%); border-radius: 75px; margin: 2rem auto; position: relative; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);">
                        <!-- Team Avatars -->
                        <div id="team-avatars-leadership" style="position: absolute; top: -20px; left: 0; right: 0; bottom: -20px; display: flex; justify-content: space-around; align-items: center;">
                            <!-- Avatars will be generated by JavaScript -->
                        </div>
                    </div>
                    
                    <!-- Current Scenario -->
                    <div style="background: rgba(255,255,255,0.1); padding: 1.5rem; border-radius: 15px; margin-top: 2rem;">
                        <h4 style="margin-bottom: 1rem;">üéØ Leadership Scenario:</h4>
                        <p id="leadership-scenario" style="opacity: 0.9; line-height: 1.6;">The team is discussing the upcoming project deadline. Two members have conflicting opinions about the approach. As the leader, you need to facilitate the discussion and make a decision.</p>
                    </div>
                    
                    <!-- Team Feedback -->
                    <div style="position: absolute; bottom: 1rem; left: 1rem; right: 1rem; background: rgba(0,0,0,0.8); padding: 1rem; border-radius: 10px; border: 2px solid #10b981;">
                        <div style="display: flex; align-items: center; margin-bottom: 0.5rem;">
                            <span style="font-size: 1.2rem; margin-right: 0.5rem;">ü§ñ</span>
                            <strong>AI Leadership Coach:</strong>
                        </div>
                        <div id="team-feedback" style="font-size: 0.85rem; opacity: 0.9; line-height: 1.4;">Welcome! I'm your AI leadership coach. I'll analyze your leadership style, provide real-time feedback, and help you navigate team challenges. Click "Start Meeting" to begin!</div>
                    </div>
                </div>
                
                <!-- Leadership Analytics -->
                <div style="background: rgba(0,0,0,0.8); border-radius: 20px; padding: 1.5rem;">
                    <h4 style="margin-bottom: 1rem; text-align: center;">üë• Leadership Metrics</h4>
                    
                    <div style="margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span>üéØ Decision Making</span>
                            <span id="decision-score">0%</span>
                        </div>
                        <div style="background: rgba(255,255,255,0.2); height: 8px; border-radius: 4px; overflow: hidden;">
                            <div id="decision-bar" style="background: linear-gradient(90deg, #10b981, #059669); height: 100%; width: 0%; transition: width 0.5s ease;"></div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span>ü§ù Team Harmony</span>
                            <span id="harmony-score">0%</span>
                        </div>
                        <div style="background: rgba(255,255,255,0.2); height: 8px; border-radius: 4px; overflow: hidden;">
                            <div id="harmony-bar" style="background: linear-gradient(90deg, #3b82f6, #1d4ed8); height: 100%; width: 0%; transition: width 0.5s ease;"></div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span>üí™ Influence</span>
                            <span id="influence-score">0%</span>
                        </div>
                        <div style="background: rgba(255,255,255,0.2); height: 8px; border-radius: 4px; overflow: hidden;">
                            <div id="influence-bar" style="background: linear-gradient(90deg, #f59e0b, #d97706); height: 100%; width: 0%; transition: width 0.5s ease;"></div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span>üó£Ô∏è Communication</span>
                            <span id="communication-score">0%</span>
                        </div>
                        <div style="background: rgba(255,255,255,0.2); height: 8px; border-radius: 4px; overflow: hidden;">
                            <div id="communication-bar" style="background: linear-gradient(90deg, #8b5cf6, #7c3aed); height: 100%; width: 0%; transition: width 0.5s ease;"></div>
                        </div>
                    </div>
                    
                    <!-- AI Conversation Panel -->
                    <div style="margin-top: 2rem; padding: 1rem; background: rgba(16, 185, 129, 0.1); border-radius: 10px; border: 1px solid rgba(16, 185, 129, 0.3);">
                        <h5 style="margin-bottom: 1rem; display: flex; align-items: center;">
                            <span style="margin-right: 0.5rem;">ü§ñ</span>
                            AI Leadership Insights
                        </h5>
                        <div id="leadership-conversation" style="max-height: 200px; overflow-y: auto; font-size: 0.8rem; line-height: 1.4;">
                            <div style="opacity: 0.7; font-style: italic;">AI will provide leadership insights and coaching during your meeting...</div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 1.5rem; padding: 1rem; background: rgba(255,255,255,0.1); border-radius: 10px;">
                        <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem;">‚è±Ô∏è</div>
                        <div>Meeting Time</div>
                        <div id="meeting-time" style="font-size: 1.2rem; font-weight: bold;">00:00</div>
                    </div>
                </div>
            </div>
            
            <!-- Leadership Controls -->
            <div style="display: flex; justify-content: center; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap;">
                <button id="meeting-btn" class="start-btn" onclick="startMeeting()" style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);">
                    üöÄ Start Meeting
                </button>
                <button class="start-btn" onclick="generateLeadershipScenario()" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                    üé≤ AI Scenario
                </button>
                <button class="start-btn" onclick="makeDecision()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                    üéØ Make Decision
                </button>
                <button class="start-btn" onclick="resolveConflict()" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                    ‚öñÔ∏è Resolve Conflict
                </button>
                <button class="start-btn" onclick="motivateTeam()" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                    üí™ Motivate Team
                </button>
                <button class="start-btn" onclick="getLeadershipFeedback()" style="background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);">
                    üí° AI Feedback
                </button>
                <button class="start-btn" onclick="showLeadershipResults()" style="background: linear-gradient(135deg, #059669 0%, #047857 100%);">
                    üìä View Results
                </button>
            </div>
            
            <!-- Groq API Key Input for Leadership (Hidden by default) -->
            <div id="leadership-api-key-section" style="background: rgba(255,255,255,0.1); padding: 2rem; border-radius: 15px; margin-bottom: 2rem; text-align: center;">
                <h4 style="margin-bottom: 1rem;">üîë AI Leadership Coach Configuration</h4>
                <p style="opacity: 0.8; margin-bottom: 1rem;">To enable AI-powered leadership coaching, you need a free Groq API key. Get one at <a href="https://console.groq.com" target="_blank" style="color: #10b981;">console.groq.com</a></p>
                <div style="display: flex; gap: 1rem; justify-content: center; align-items: center; flex-wrap: wrap;">
                    <input type="password" id="leadership-groq-api-key" placeholder="Enter your Groq API key" style="
                        background: rgba(255,255,255,0.1);
                        border: 1px solid rgba(255,255,255,0.3);
                        color: white;
                        padding: 0.75rem 1rem;
                        border-radius: 10px;
                        width: 300px;
                        font-size: 0.9rem;
                    ">
                    <button onclick="saveLeadershipApiKey()" style="
                        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                        color: white;
                        border: none;
                        padding: 0.75rem 1.5rem;
                        border-radius: 10px;
                        cursor: pointer;
                        font-weight: 600;
                    ">Save Key</button>
                </div>
                <p style="font-size: 0.8rem; opacity: 0.7; margin-top: 1rem;">Your API key is stored locally and never shared. It's only used for AI leadership coaching.</p>
            </div>
        </div>
    </div>
    
    <script>
        // Global variables
        let isTraining = false;
        let sessionStartTime = 0;
        let sessionTimer = null;
        let metricsInterval = null;
        let audienceMembers = [];
        let ideasCount = 0;
        let groqApiKey = '';
        let speechTranscript = '';
        let conversationHistory = [];
        let currentTopic = '';
        let speechRecognition = null;
        
        // Groq AI Configuration
        const GROQ_API_URL = 'https://api.groq.com/openai/v1/chat/completions';
        
        // Initialize speech recognition
        function initializeSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                speechRecognition = new SpeechRecognition();
                speechRecognition.continuous = true;
                speechRecognition.interimResults = true;
                speechRecognition.lang = 'en-US';
                
                speechRecognition.onresult = function(event) {
                    let transcript = '';
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        if (event.results[i].isFinal) {
                            transcript += event.results[i][0].transcript + ' ';
                        }
                    }
                    
                    if (transcript.trim()) {
                        speechTranscript += transcript;
                        // Analyze speech with AI every 10 seconds of speech
                        if (speechTranscript.split(' ').length % 50 === 0) {
                            analyzeWithGroq(transcript);
                        }
                    }
                };
                
                speechRecognition.onerror = function(event) {
                    console.log('Speech recognition error:', event.error);
                };
            }
        }
        
        // Save Groq API Key
        function saveApiKey() {
            const keyInput = document.getElementById('groq-api-key');
            const key = keyInput.value.trim();
            
            if (key) {
                groqApiKey = key;
                localStorage.setItem('groq-api-key', key);
                document.getElementById('api-key-section').style.display = 'none';
                showMessage('‚úÖ Groq API key saved! AI features are now enabled.');
                updateAIFeedback('ü§ñ AI Coach activated! I\'m ready to help you improve your speaking skills.');
            } else {
                showMessage('‚ùå Please enter a valid API key.');
            }
        }
        
        // Load saved API key or from environment
        function loadApiKey() {
            // Try to load from environment variables first (if using a build system)
            const envApiKey = process?.env?.REACT_APP_GROQ_API_KEY || window?.ENV?.REACT_APP_GROQ_API_KEY;
            
            // Then try localStorage
            const savedKey = localStorage.getItem('groq-api-key');
            
            if (envApiKey && envApiKey !== 'your_groq_api_key_here') {
                groqApiKey = envApiKey;
                document.getElementById('api-key-section').style.display = 'none';
                updateAIFeedback('ü§ñ AI Coach ready! API key loaded from environment configuration.');
            } else if (savedKey) {
                groqApiKey = savedKey;
                document.getElementById('api-key-section').style.display = 'none';
                updateAIFeedback('ü§ñ AI Coach ready! I\'ll help you practice and improve your speaking skills.');
            } else {
                // Show API key input section
                updateAIFeedback('üîë Please configure your Groq API key to enable AI features. Get a free key at console.groq.com');
            }
        }
        
        // Make API call to Groq
        async function callGroqAPI(messages, temperature = 0.7) {
            if (!groqApiKey) {
                showMessage('‚ùå Please set your Groq API key first.');
                return null;
            }
            
            try {
                const response = await fetch(GROQ_API_URL, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${groqApiKey}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'llama3-8b-8192',
                        messages: messages,
                        temperature: temperature,
                        max_tokens: 500,
                        stream: false
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                return data.choices[0].message.content;
            } catch (error) {
                console.error('Groq API error:', error);
                showMessage('‚ùå AI service temporarily unavailable. Please try again.');
                return null;
            }
        }
        
        // Get random speaking topic from AI
        async function getRandomTopic() {
            updateAIFeedback('ü§ñ Generating a random speaking topic for you...');
            
            const messages = [
                {
                    role: 'system',
                    content: 'You are a public speaking coach. Generate interesting, engaging speaking topics for practice. Topics should be thought-provoking but accessible. Provide just the topic, no additional text.'
                },
                {
                    role: 'user',
                    content: 'Give me a random speaking topic that would be good for public speaking practice. Make it interesting and engaging.'
                }
            ];
            
            const topic = await callGroqAPI(messages, 0.9);
            
            if (topic) {
                currentTopic = topic.trim();
                document.getElementById('current-topic').textContent = currentTopic;
                updateAIFeedback(`üéØ New topic generated! Take a moment to think about "${currentTopic}" and then start speaking when you're ready.`);
                addToConversation('ü§ñ AI Coach', `New speaking topic: "${currentTopic}"`);
            }
        }
        
        // Analyze speech with Groq AI
        async function analyzeWithGroq(transcript) {
            if (!transcript.trim()) return;
            
            const messages = [
                {
                    role: 'system',
                    content: `You are an expert public speaking coach. Analyze the user's speech and provide constructive feedback. Be encouraging but specific about improvements. Current topic: "${currentTopic}"`
                },
                {
                    role: 'user',
                    content: `Please analyze this part of my speech: "${transcript}". Give me specific feedback on content, delivery, and how well I'm addressing the topic.`
                }
            ];
            
            const feedback = await callGroqAPI(messages);
            
            if (feedback) {
                updateAIFeedback(feedback);
                addToConversation('ü§ñ AI Analysis', feedback);
            }
        }
        
        // Ask AI a question about speaking
        async function askAIQuestion() {
            const question = prompt('ü§ñ Ask me anything about public speaking, your current topic, or how to improve your presentation:');
            
            if (!question) return;
            
            addToConversation('üë§ You', question);
            updateAIFeedback('ü§ñ Thinking about your question...');
            
            const messages = [
                {
                    role: 'system',
                    content: `You are an expert public speaking coach. Answer questions about public speaking, presentation skills, and communication. Current topic being practiced: "${currentTopic}". Be helpful, specific, and encouraging.`
                },
                {
                    role: 'user',
                    content: question
                }
            ];
            
            const answer = await callGroqAPI(messages);
            
            if (answer) {
                updateAIFeedback(answer);
                addToConversation('ü§ñ AI Coach', answer);
            }
        }
        
        // Get comprehensive AI feedback
        async function getAIFeedback() {
            if (!speechTranscript.trim()) {
                showMessage('üé§ Please speak first so I can analyze your presentation!');
                return;
            }
            
            updateAIFeedback('ü§ñ Analyzing your complete speech performance...');
            
            const messages = [
                {
                    role: 'system',
                    content: `You are an expert public speaking coach. Provide comprehensive feedback on the user's speech including: content quality, structure, delivery, engagement, and specific improvement suggestions. Current topic: "${currentTopic}"`
                },
                {
                    role: 'user',
                    content: `Please provide comprehensive feedback on my complete speech: "${speechTranscript}". Rate my performance and give specific suggestions for improvement.`
                }
            ];
            
            const feedback = await callGroqAPI(messages);
            
            if (feedback) {
                updateAIFeedback(feedback);
                addToConversation('ü§ñ Comprehensive Feedback', feedback);
                
                // Show detailed feedback modal
                showDetailedFeedback(feedback);
            }
        }
        
        // Generate AI questions during speech
        async function generateAIQuestion() {
            if (!speechTranscript.trim() || !currentTopic) return;
            
            const messages = [
                {
                    role: 'system',
                    content: `You are an audience member listening to a speech about "${currentTopic}". Generate a thoughtful, relevant question based on what the speaker has said so far. Make it challenging but fair.`
                },
                {
                    role: 'user',
                    content: `Based on this speech content: "${speechTranscript.slice(-200)}", what question would you ask the speaker?`
                }
            ];
            
            const question = await callGroqAPI(messages, 0.8);
            
            if (question) {
                showAIQuestion(question);
            }
        }
        
        // Show AI-generated question as a challenge (FIXED)
        function showAIQuestion(question) {
            const modal = document.createElement('div');
            modal.id = 'ai-question-modal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
                backdrop-filter: blur(10px);
            `;
            
            // Clean the question text for safe HTML insertion
            const cleanQuestion = question.replace(/"/g, '&quot;').replace(/'/g, '&#39;');
            
            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #1f2937 0%, #111827 100%); border-radius: 20px; padding: 3rem; max-width: 600px; text-align: center; color: white; border: 2px solid #10b981;">
                    <h3 style="font-size: 2rem; margin-bottom: 1rem; color: #10b981;">ü§ñ AI Audience Question</h3>
                    <p style="font-size: 1.1rem; margin-bottom: 2rem; line-height: 1.6; opacity: 0.9;">${cleanQuestion}</p>
                    <div style="display: flex; gap: 1rem; justify-content: center;">
                        <button id="respond-btn" style="
                            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                            color: white;
                            border: none;
                            padding: 1rem 2rem;
                            border-radius: 15px;
                            cursor: pointer;
                            font-weight: 600;
                        ">üé§ Respond</button>
                        <button id="skip-btn" style="
                            background: rgba(255, 255, 255, 0.1);
                            color: white;
                            border: 1px solid rgba(255, 255, 255, 0.2);
                            padding: 1rem 2rem;
                            border-radius: 15px;
                            cursor: pointer;
                        ">‚è≠Ô∏è Skip</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add event listeners after modal is added to DOM
            document.getElementById('respond-btn').addEventListener('click', function() {
                respondToAIQuestion(question);
            });
            
            document.getElementById('skip-btn').addEventListener('click', function() {
                closeAIQuestionModal();
            });
            
            window.currentModal = modal;
        }
        
        // Close AI question modal
        function closeAIQuestionModal() {
            const modal = document.getElementById('ai-question-modal');
            if (modal && document.body.contains(modal)) {
                document.body.removeChild(modal);
            }
            window.currentModal = null;
        }
        
        // Respond to AI question (FIXED)
        function respondToAIQuestion(question) {
            closeAIQuestionModal();
            addToConversation('ü§ñ AI Question', question);
            updateAIFeedback('üé§ Great! Now respond to the question. I\'ll analyze your answer and provide feedback.');
            
            // Give user time to respond, then analyze
            setTimeout(() => {
                if (isTraining) {
                    analyzeQuestionResponse(question);
                }
            }, 15000);
        }
        
        // Analyze response to AI question
        async function analyzeQuestionResponse(question) {
            const recentSpeech = speechTranscript.slice(-300); // Last 300 characters
            
            const messages = [
                {
                    role: 'system',
                    content: 'You are a public speaking coach. Analyze how well the speaker answered the audience question. Provide feedback on their response quality, clarity, and confidence.'
                },
                {
                    role: 'user',
                    content: `Question asked: "${question}"\nSpeaker's response: "${recentSpeech}"\n\nHow well did they answer the question?`
                }
            ];
            
            const feedback = await callGroqAPI(messages);
            
            if (feedback) {
                updateAIFeedback(feedback);
                addToConversation('ü§ñ Response Analysis', feedback);
            }
        }
        
        // Update AI feedback display
        function updateAIFeedback(message) {
            const feedbackElement = document.getElementById('ai-feedback');
            if (feedbackElement) {
                feedbackElement.textContent = message;
            }
        }
        
        // Add message to conversation history
        function addToConversation(speaker, message) {
            const conversationElement = document.getElementById('ai-conversation');
            if (!conversationElement) return;
            
            const messageDiv = document.createElement('div');
            messageDiv.style.cssText = `
                margin-bottom: 1rem;
                padding: 0.5rem;
                background: rgba(255,255,255,0.05);
                border-radius: 8px;
                border-left: 3px solid ${speaker.includes('ü§ñ') ? '#10b981' : '#3b82f6'};
            `;
            
            messageDiv.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 0.25rem; font-size: 0.75rem; opacity: 0.8;">${speaker}</div>
                <div style="font-size: 0.8rem; line-height: 1.3;">${message}</div>
            `;
            
            conversationElement.appendChild(messageDiv);
            conversationElement.scrollTop = conversationElement.scrollHeight;
            
            // Keep only last 10 messages
            while (conversationElement.children.length > 10) {
                conversationElement.removeChild(conversationElement.firstChild);
            }
        }
        
        // Show detailed feedback modal
        function showDetailedFeedback(feedback) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.9);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
                backdrop-filter: blur(10px);
                padding: 2rem;
            `;
            
            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #1f2937 0%, #111827 100%); border-radius: 20px; padding: 3rem; max-width: 800px; max-height: 80vh; overflow-y: auto; color: white; border: 2px solid #10b981;">
                    <h3 style="font-size: 2rem; margin-bottom: 2rem; color: #10b981; text-align: center;">ü§ñ AI Performance Analysis</h3>
                    <div style="font-size: 1rem; line-height: 1.6; margin-bottom: 2rem; white-space: pre-line;">${feedback}</div>
                    <div style="text-align: center;">
                        <button onclick="closeModal(this)" style="
                            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                            color: white;
                            border: none;
                            padding: 1rem 2rem;
                            border-radius: 15px;
                            cursor: pointer;
                            font-weight: 600;
                            font-size: 1rem;
                        ">‚úÖ Got it!</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            window.currentModal = modal;
        }
        
        // Advanced AI Features
        let emotionAnalysisInterval = null;
        let adaptiveCoachingLevel = 'beginner'; // beginner, intermediate, advanced
        let userPerformanceHistory = [];
        let currentEmotionalState = 'neutral';
        let speechPatterns = {
            fillerWords: 0,
            averagePace: 0,
            confidenceLevel: 0,
            engagementScore: 0
        };
        
        // Emotion and Sentiment Analysis
        async function analyzeEmotionAndSentiment(transcript) {
            if (!transcript.trim()) return;
            
            const messages = [
                {
                    role: 'system',
                    content: 'You are an expert in emotional intelligence and communication analysis. Analyze the emotional tone, confidence level, and sentiment of the speaker. Respond with a JSON object containing: emotion (happy/nervous/confident/anxious/excited/calm), confidence (1-10), sentiment (positive/neutral/negative), and energy (low/medium/high).'
                },
                {
                    role: 'user',
                    content: `Analyze the emotional state and sentiment of this speech: "${transcript}"`
                }
            ];
            
            const analysis = await callGroqAPI(messages, 0.3);
            
            if (analysis) {
                try {
                    const emotionData = JSON.parse(analysis);
                    updateEmotionalFeedback(emotionData);
                    adaptCoachingStyle(emotionData);
                } catch (e) {
                    // Fallback to text analysis
                    updateEmotionalFeedback({ emotion: 'analyzing', confidence: 5, sentiment: 'neutral', energy: 'medium' });
                }
            }
        }
        
        // Update emotional feedback display
        function updateEmotionalFeedback(emotionData) {
            currentEmotionalState = emotionData.emotion || 'neutral';
            
            // Update audience reactions based on emotion
            const audienceReaction = getAudienceReactionFromEmotion(emotionData);
            updateAudienceReactions(audienceReaction);
            
            // Add emotion indicator to AI feedback
            const emotionEmoji = getEmotionEmoji(emotionData.emotion);
            const confidenceBar = '‚ñà'.repeat(Math.floor(emotionData.confidence / 2));
            
            addToConversation('üß† Emotion AI', `${emotionEmoji} Emotion: ${emotionData.emotion} | Confidence: ${confidenceBar} (${emotionData.confidence}/10) | Energy: ${emotionData.energy}`);
        }
        
        // Get emoji for emotion
        function getEmotionEmoji(emotion) {
            const emojis = {
                happy: 'üòä', confident: 'üí™', excited: 'üéâ', calm: 'üòå',
                nervous: 'üò∞', anxious: 'üòü', analyzing: 'ü§î', neutral: 'üòê'
            };
            return emojis[emotion] || 'üòê';
        }
        
        // Get audience reaction based on emotion
        function getAudienceReactionFromEmotion(emotionData) {
            if (emotionData.confidence >= 7 && emotionData.sentiment === 'positive') return 85;
            if (emotionData.confidence >= 5 && emotionData.sentiment !== 'negative') return 65;
            if (emotionData.confidence < 4 || emotionData.sentiment === 'negative') return 35;
            return 50;
        }
        
        // Adaptive Coaching System
        function adaptCoachingStyle(emotionData) {
            let coachingMessage = '';
            
            if (emotionData.emotion === 'nervous' || emotionData.emotion === 'anxious') {
                coachingMessage = 'üåü I notice you might be feeling nervous. Take a deep breath and remember - your audience wants you to succeed! Try speaking a bit slower and focus on one friendly face in the audience.';
            } else if (emotionData.confidence >= 8) {
                coachingMessage = 'üî• Excellent confidence! Your audience is engaged. Now try adding more dynamic gestures and varying your vocal tone to keep this energy going.';
            } else if (emotionData.energy === 'low') {
                coachingMessage = '‚ö° I sense your energy could be higher. Try standing taller, using more hand gestures, and projecting your voice with more enthusiasm!';
            } else if (emotionData.sentiment === 'positive' && emotionData.confidence >= 6) {
                coachingMessage = '‚ú® Great positive energy! Your audience is responding well. Consider adding a personal story or example to deepen the connection.';
            } else {
                coachingMessage = 'üëç You\'re doing well! Focus on maintaining eye contact and speaking with conviction. Your message is important!';
            }
            
            updateAIFeedback(coachingMessage);
        }
        
        // Advanced Topic Generation with Difficulty Levels
        async function getAdvancedTopic(difficulty = 'intermediate', category = 'general') {
            updateAIFeedback('üéØ Generating an advanced speaking topic tailored to your skill level...');
            
            const difficultyPrompts = {
                beginner: 'Create a simple, relatable topic that a beginner can easily discuss with personal examples.',
                intermediate: 'Create a moderately challenging topic that requires some analysis and structured thinking.',
                advanced: 'Create a complex, thought-provoking topic that requires deep analysis, multiple perspectives, and sophisticated argumentation.'
            };
            
            const categoryPrompts = {
                general: 'any interesting general topic',
                business: 'business, leadership, or professional development',
                technology: 'technology, innovation, or digital transformation',
                social: 'social issues, community, or human relationships',
                personal: 'personal growth, life skills, or self-improvement'
            };
            
            const messages = [
                {
                    role: 'system',
                    content: `You are a public speaking coach. Generate a ${difficulty} level speaking topic about ${categoryPrompts[category]}. ${difficultyPrompts[difficulty]} Provide just the topic, no additional text.`
                },
                {
                    role: 'user',
                    content: `Generate a ${difficulty} level speaking topic for ${category} category.`
                }
            ];
            
            const topic = await callGroqAPI(messages, 0.9);
            
            if (topic) {
                currentTopic = topic.trim();
                document.getElementById('current-topic').textContent = currentTopic;
                updateAIFeedback(`üéØ ${difficulty.charAt(0).toUpperCase() + difficulty.slice(1)} level topic generated! Take a moment to organize your thoughts about "${currentTopic}" and then start speaking when ready.`);
                addToConversation('üé≤ Topic Generator', `${difficulty.toUpperCase()} - ${currentTopic}`);
            }
        }
        
        // Speech Pattern Analysis
        function analyzeSpeechPatterns(transcript) {
            if (!transcript) return;
            
            const words = transcript.split(' ');
            const fillerWords = ['um', 'uh', 'like', 'you know', 'so', 'actually', 'basically'];
            let fillerCount = 0;
            
            words.forEach(word => {
                if (fillerWords.includes(word.toLowerCase())) {
                    fillerCount++;
                }
            });
            
            speechPatterns.fillerWords = fillerCount;
            speechPatterns.averagePace = words.length; // Simplified WPM calculation
            
            // Update filler word feedback
            if (fillerCount > 5) {
                addToConversation('üìä Pattern Analysis', `‚ö†Ô∏è Detected ${fillerCount} filler words. Try pausing instead of using "um" or "uh".`);
            }
        }
        
        // Personalized Improvement Plan
        async function generateImprovementPlan() {
            const performanceData = {
                currentTopic,
                speechTranscript: speechTranscript.slice(-500),
                emotionalState: currentEmotionalState,
                speechPatterns,
                sessionDuration: Math.floor((Date.now() - sessionStartTime) / 1000)
            };
            
            const messages = [
                {
                    role: 'system',
                    content: 'You are an expert public speaking coach. Based on the user\'s performance data, create a personalized improvement plan with specific, actionable steps. Include strengths, areas for improvement, and practice exercises.'
                },
                {
                    role: 'user',
                    content: `Create a personalized improvement plan based on this data: ${JSON.stringify(performanceData)}`
                }
            ];
            
            const plan = await callGroqAPI(messages, 0.7);
            
            if (plan) {
                showImprovementPlan(plan);
            }
        }
        
        // Show improvement plan modal
        function showImprovementPlan(plan) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.9);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
                backdrop-filter: blur(10px);
                padding: 2rem;
            `;
            
            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #1f2937 0%, #111827 100%); border-radius: 20px; padding: 3rem; max-width: 900px; max-height: 80vh; overflow-y: auto; color: white; border: 2px solid #10b981;">
                    <h3 style="font-size: 2rem; margin-bottom: 2rem; color: #10b981; text-align: center;">üéØ Your Personalized Improvement Plan</h3>
                    <div style="font-size: 1rem; line-height: 1.6; margin-bottom: 2rem; white-space: pre-line;">${plan}</div>
                    <div style="text-align: center; display: flex; gap: 1rem; justify-content: center;">
                        <button onclick="saveImprovementPlan('${plan.replace(/'/g, "\\'")}'); closeModal(this)" style="
                            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
                            color: white;
                            border: none;
                            padding: 1rem 2rem;
                            border-radius: 15px;
                            cursor: pointer;
                            font-weight: 600;
                            font-size: 1rem;
                        ">üíæ Save Plan</button>
                        <button onclick="closeModal(this)" style="
                            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                            color: white;
                            border: none;
                            padding: 1rem 2rem;
                            border-radius: 15px;
                            cursor: pointer;
                            font-weight: 600;
                            font-size: 1rem;
                        ">‚úÖ Got it!</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            window.currentModal = modal;
        }
        
        // Save improvement plan
        function saveImprovementPlan(plan) {
            const plans = JSON.parse(localStorage.getItem('virtuprep-improvement-plans') || '[]');
            plans.push({
                date: new Date().toISOString(),
                topic: currentTopic,
                plan: plan
            });
            localStorage.setItem('virtuprep-improvement-plans', JSON.stringify(plans));
            showMessage('üíæ Improvement plan saved! You can review it anytime in your progress dashboard.');
        }
        
        // Advanced Challenge Generation
        async function generateAdvancedChallenge(challengeType = 'random') {
            const challengeTypes = {
                technical: 'A technical difficulty occurs during your presentation',
                hostile: 'You face a hostile or skeptical audience member',
                time: 'You have limited time to make your point',
                complex: 'You need to explain a complex concept simply',
                emotional: 'You need to handle an emotional or sensitive topic',
                interactive: 'You need to engage a disinterested audience'
            };
            
            const selectedType = challengeType === 'random' ? 
                Object.keys(challengeTypes)[Math.floor(Math.random() * Object.keys(challengeTypes).length)] : 
                challengeType;
            
            const messages = [
                {
                    role: 'system',
                    content: `You are a public speaking trainer. Create a realistic, challenging scenario: ${challengeTypes[selectedType]}. Current topic: "${currentTopic}". Provide the scenario description and 3 response options.`
                },
                {
                    role: 'user',
                    content: `Create a ${selectedType} challenge scenario for the topic "${currentTopic}"`
                }
            ];
            
            const challenge = await callGroqAPI(messages, 0.8);
            
            if (challenge) {
                showAdvancedChallenge(challenge, selectedType);
            }
        }
        
        // Show advanced challenge
        function showAdvancedChallenge(challenge, type) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
                backdrop-filter: blur(10px);
            `;
            
            const typeEmojis = {
                technical: 'üîß', hostile: 'üò†', time: '‚è∞', 
                complex: 'üß†', emotional: 'üí≠', interactive: 'üé≠'
            };
            
            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); border-radius: 20px; padding: 3rem; max-width: 700px; text-align: center; color: white; border: 2px solid #ef4444;">
                    <h3 style="font-size: 2rem; margin-bottom: 1rem; color: #fecaca;">${typeEmojis[type]} Advanced Challenge!</h3>
                    <div style="background: rgba(0,0,0,0.3); padding: 2rem; border-radius: 15px; margin: 2rem 0;">
                        <p style="font-size: 1.1rem; line-height: 1.6; white-space: pre-line;">${challenge}</p>
                    </div>
                    <div style="display: flex; gap: 1rem; justify-content: center;">
                        <button onclick="handleAdvancedChallenge('accept'); closeModal(this)" style="
                            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                            color: white;
                            border: none;
                            padding: 1rem 2rem;
                            border-radius: 15px;
                            cursor: pointer;
                            font-weight: 600;
                        ">üí™ Accept Challenge</button>
                        <button onclick="handleAdvancedChallenge('skip'); closeModal(this)" style="
                            background: rgba(255, 255, 255, 0.1);
                            color: white;
                            border: 1px solid rgba(255, 255, 255, 0.2);
                            padding: 1rem 2rem;
                            border-radius: 15px;
                            cursor: pointer;
                        ">‚è≠Ô∏è Skip for Now</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            window.currentModal = modal;
        }
        
        // Handle advanced challenge response
        function handleAdvancedChallenge(action) {
            if (action === 'accept') {
                updateAIFeedback('üí™ Challenge accepted! Show your expertise and handle this situation with confidence. I\'ll analyze your response.');
                addToConversation('üéØ Challenge', 'Advanced challenge accepted - demonstrating problem-solving skills');
                
                // Analyze response after 20 seconds
                setTimeout(() => {
                    if (isTraining) {
                        analyzeAdvancedChallengeResponse();
                    }
                }, 20000);
            } else {
                updateAIFeedback('‚è≠Ô∏è No problem! Challenges help you grow, but you can tackle them when you\'re ready. Keep practicing!');
            }
        }
        
        // Advanced feature supporting functions
        
        // Show topic generator with categories and difficulty
        function showTopicGenerator() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
                backdrop-filter: blur(10px);
            `;
            
            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #1f2937 0%, #111827 100%); border-radius: 20px; padding: 3rem; max-width: 600px; text-align: center; color: white; border: 2px solid #8b5cf6;">
                    <h3 style="font-size: 2rem; margin-bottom: 2rem; color: #8b5cf6;">üé≤ Smart Topic Generator</h3>
                    
                    <div style="margin-bottom: 2rem;">
                        <h4 style="margin-bottom: 1rem;">üìö Difficulty Level:</h4>
                        <div style="display: flex; gap: 1rem; justify-content: center; margin-bottom: 2rem;">
                            <button onclick="selectDifficulty('beginner')" class="difficulty-btn" data-level="beginner" style="
                                background: rgba(16, 185, 129, 0.2);
                                border: 2px solid #10b981;
                                color: white;
                                padding: 0.75rem 1.5rem;
                                border-radius: 15px;
                                cursor: pointer;
                            ">üìö Beginner</button>
                            <button onclick="selectDifficulty('intermediate')" class="difficulty-btn" data-level="intermediate" style="
                                background: rgba(245, 158, 11, 0.2);
                                border: 2px solid #f59e0b;
                                color: white;
                                padding: 0.75rem 1.5rem;
                                border-radius: 15px;
                                cursor: pointer;
                            ">üéì Intermediate</button>
                            <button onclick="selectDifficulty('advanced')" class="difficulty-btn" data-level="advanced" style="
                                background: rgba(239, 68, 68, 0.2);
                                border: 2px solid #ef4444;
                                color: white;
                                padding: 0.75rem 1.5rem;
                                border-radius: 15px;
                                cursor: pointer;
                            ">üèÜ Advanced</button>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 2rem;">
                        <h4 style="margin-bottom: 1rem;">üéØ Topic Category:</h4>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                            <button onclick="selectCategory('general')" class="category-btn" data-category="general" style="
                                background: rgba(255, 255, 255, 0.1);
                                border: 1px solid rgba(255, 255, 255, 0.2);
                                color: white;
                                padding: 0.75rem;
                                border-radius: 10px;
                                cursor: pointer;
                            ">üåü General</button>
                            <button onclick="selectCategory('business')" class="category-btn" data-category="business" style="
                                background: rgba(255, 255, 255, 0.1);
                                border: 1px solid rgba(255, 255, 255, 0.2);
                                color: white;
                                padding: 0.75rem;
                                border-radius: 10px;
                                cursor: pointer;
                            ">üíº Business</button>
                            <button onclick="selectCategory('technology')" class="category-btn" data-category="technology" style="
                                background: rgba(255, 255, 255, 0.1);
                                border: 1px solid rgba(255, 255, 255, 0.2);
                                color: white;
                                padding: 0.75rem;
                                border-radius: 10px;
                                cursor: pointer;
                            ">üíª Technology</button>
                            <button onclick="selectCategory('social')" class="category-btn" data-category="social" style="
                                background: rgba(255, 255, 255, 0.1);
                                border: 1px solid rgba(255, 255, 255, 0.2);
                                color: white;
                                padding: 0.75rem;
                                border-radius: 10px;
                                cursor: pointer;
                            ">ü§ù Social</button>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; justify-content: center;">
                        <button onclick="generateSmartTopic(); closeModal(this)" style="
                            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
                            color: white;
                            border: none;
                            padding: 1rem 2rem;
                            border-radius: 15px;
                            cursor: pointer;
                            font-weight: 600;
                        ">üé≤ Generate Topic</button>
                        <button onclick="closeModal(this)" style="
                            background: rgba(255, 255, 255, 0.1);
                            color: white;
                            border: 1px solid rgba(255, 255, 255, 0.2);
                            padding: 1rem 2rem;
                            border-radius: 15px;
                            cursor: pointer;
                        ">‚ùå Cancel</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            window.currentModal = modal;
            window.selectedDifficulty = 'intermediate';
            window.selectedCategory = 'general';
        }
        
        // Select difficulty level
        function selectDifficulty(level) {
            window.selectedDifficulty = level;
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.style.opacity = btn.dataset.level === level ? '1' : '0.5';
            });
        }
        
        // Select category
        function selectCategory(category) {
            window.selectedCategory = category;
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.style.opacity = btn.dataset.category === category ? '1' : '0.5';
            });
        }
        
        // Generate smart topic with selected parameters
        function generateSmartTopic() {
            const difficulty = window.selectedDifficulty || 'intermediate';
            const category = window.selectedCategory || 'general';
            getAdvancedTopic(difficulty, category);
        }
        
        // Set coaching level
        function setCoachingLevel(level) {
            adaptiveCoachingLevel = level;
            document.getElementById('coaching-level').textContent = level.charAt(0).toUpperCase() + level.slice(1);
            
            const messages = {
                beginner: 'üìö Coaching level set to Beginner. I\'ll provide gentle guidance and focus on building your confidence.',
                intermediate: 'üéì Coaching level set to Intermediate. I\'ll give you more detailed feedback and challenges.',
                advanced: 'üèÜ Coaching level set to Advanced. I\'ll provide expert-level analysis and push you to excel.'
            };
            
            updateAIFeedback(messages[level]);
            addToConversation('üéØ Coaching Level', `Set to ${level.toUpperCase()}`);
        }
        
        // Show progress dashboard
        function showProgressDashboard() {
            const sessions = JSON.parse(localStorage.getItem('virtuprep-sessions') || '[]');
            const plans = JSON.parse(localStorage.getItem('virtuprep-improvement-plans') || '[]');
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.9);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
                backdrop-filter: blur(10px);
                padding: 2rem;
            `;
            
            const avgScore = sessions.length > 0 ? 
                Math.round(sessions.reduce((sum, s) => sum + (s.score || 0), 0) / sessions.length) : 0;
            
            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #1f2937 0%, #111827 100%); border-radius: 20px; padding: 3rem; max-width: 900px; max-height: 80vh; overflow-y: auto; color: white; border: 2px solid #f59e0b;">
                    <h3 style="font-size: 2rem; margin-bottom: 2rem; color: #f59e0b; text-align: center;">üìà Your Progress Dashboard</h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 2rem; margin-bottom: 3rem;">
                        <div style="background: rgba(16, 185, 129, 0.1); padding: 1.5rem; border-radius: 15px; text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: #10b981;">${sessions.length}</div>
                            <div>Total Sessions</div>
                        </div>
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 1.5rem; border-radius: 15px; text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: #3b82f6;">${avgScore}%</div>
                            <div>Average Score</div>
                        </div>
                        <div style="background: rgba(139, 92, 246, 0.1); padding: 1.5rem; border-radius: 15px; text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: #8b5cf6;">${plans.length}</div>
                            <div>Improvement Plans</div>
                        </div>
                        <div style="background: rgba(245, 158, 11, 0.1); padding: 1.5rem; border-radius: 15px; text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: #f59e0b;">${adaptiveCoachingLevel}</div>
                            <div>Current Level</div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 2rem;">
                        <h4 style="margin-bottom: 1rem;">üìä Recent Sessions:</h4>
                        <div style="max-height: 200px; overflow-y: auto;">
                            ${sessions.slice(-5).map(session => `
                                <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 10px; margin-bottom: 0.5rem;">
                                    <div style="display: flex; justify-content: space-between;">
                                        <span>${session.topic || 'Practice Session'}</span>
                                        <span style="color: #10b981;">${session.score || 0}%</span>
                                    </div>
                                    <div style="font-size: 0.8rem; opacity: 0.7;">${new Date(session.date).toLocaleDateString()}</div>
                                </div>
                            `).join('') || '<div style="opacity: 0.7; text-align: center;">No sessions yet - start practicing!</div>'}
                        </div>
                    </div>
                    
                    <div style="text-align: center;">
                        <button onclick="exportProgress(); closeModal(this)" style="
                            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
                            color: white;
                            border: none;
                            padding: 1rem 2rem;
                            border-radius: 15px;
                            cursor: pointer;
                            font-weight: 600;
                            margin-right: 1rem;
                        ">üíæ Export Data</button>
                        <button onclick="closeModal(this)" style="
                            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                            color: white;
                            border: none;
                            padding: 1rem 2rem;
                            border-radius: 15px;
                            cursor: pointer;
                            font-weight: 600;
                        ">‚úÖ Close</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            window.currentModal = modal;
            
            // Update progress display
            updateProgressDisplay();
        }
        
        // Update progress display
        function updateProgressDisplay() {
            const sessions = JSON.parse(localStorage.getItem('virtuprep-sessions') || '[]');
            const avgScore = sessions.length > 0 ? 
                Math.round(sessions.reduce((sum, s) => sum + (s.score || 0), 0) / sessions.length) : 0;
            
            const sessionCountEl = document.getElementById('session-count');
            const avgScoreEl = document.getElementById('avg-score');
            const improvementEl = document.getElementById('improvement-trend');
            
            if (sessionCountEl) sessionCountEl.textContent = sessions.length;
            if (avgScoreEl) avgScoreEl.textContent = avgScore + '%';
            if (improvementEl) {
                const trend = sessions.length >= 2 && sessions[sessions.length - 1].score > sessions[sessions.length - 2].score ? 'üìà' : 'üìä';
                improvementEl.textContent = trend;
            }
        }
        
        // Export progress data
        function exportProgress() {
            const sessions = JSON.parse(localStorage.getItem('virtuprep-sessions') || '[]');
            const plans = JSON.parse(localStorage.getItem('virtuprep-improvement-plans') || '[]');
            
            const data = {
                sessions,
                plans,
                exportDate: new Date().toISOString(),
                totalSessions: sessions.length,
                averageScore: sessions.length > 0 ? Math.round(sessions.reduce((sum, s) => sum + (s.score || 0), 0) / sessions.length) : 0
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `virtuprep-progress-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showMessage('üíæ Progress data exported successfully!');
        }
        
        // Save session data
        function saveSessionData(sessionData) {
            const sessions = JSON.parse(localStorage.getItem('virtuprep-sessions') || '[]');
            sessions.push({
                ...sessionData,
                date: new Date().toISOString(),
                topic: currentTopic,
                duration: Math.floor((Date.now() - sessionStartTime) / 1000),
                emotionalState: currentEmotionalState,
                coachingLevel: adaptiveCoachingLevel
            });
            localStorage.setItem('virtuprep-sessions', JSON.stringify(sessions));
            updateProgressDisplay();
        }
        
        // Team Leadership Functions
        function initializeTeamAvatars() {
            const avatarsContainer = document.getElementById('team-avatars-leadership');
            if (!avatarsContainer) return;
            
            avatarsContainer.innerHTML = '';
            
            const avatarTypes = ['agreeing', 'neutral', 'disagreeing', 'neutral', 'agreeing'];
            avatarTypes.forEach((type, index) => {
                const avatar = document.createElement('div');
                avatar.style.cssText = `
                    width: 50px;
                    height: 60px;
                    border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
                    background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
                    transition: all 0.5s ease;
                    cursor: pointer;
                    position: relative;
                `;
                avatar.onclick = () => interactWithAvatar(avatar, index);
                avatarsContainer.appendChild(avatar);
            });
        }
        
        function interactWithAvatar(avatar, index) {
            const states = ['agreeing', 'neutral', 'disagreeing', 'speaking'];
            const colors = [
                'linear-gradient(135deg, #10b981 0%, #059669 100%)', // agreeing
                'linear-gradient(135deg, #6b7280 0%, #4b5563 100%)', // neutral
                'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)', // disagreeing
                'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)'  // speaking
            ];
            
            const currentState = avatar.dataset.state || 'neutral';
            const currentIndex = states.indexOf(currentState);
            const nextIndex = (currentIndex + 1) % states.length;
            const nextState = states[nextIndex];
            
            avatar.style.background = colors[nextIndex];
            avatar.dataset.state = nextState;
            
            // Update team feedback based on interaction
            const feedbacks = {
                agreeing: 'Team member is nodding in agreement with your leadership approach.',
                neutral: 'Team member is listening attentively to your guidance.',
                disagreeing: 'Team member seems to have concerns about the direction.',
                speaking: 'Team member is actively contributing to the discussion.'
            };
            
            document.getElementById('team-feedback').textContent = feedbacks[nextState];
        }
        
        let meetingActive = false;
        let meetingStartTime = 0;
        let meetingTimer = null;
        let leadershipMetricsInterval = null;
        
        function startMeeting() {
            const meetingBtn = document.getElementById('meeting-btn');
            
            if (!meetingActive) {
                meetingActive = true;
                meetingStartTime = Date.now();
                meetingBtn.textContent = 'üî¥ End Meeting';
                meetingBtn.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
                
                // Start meeting timer
                meetingTimer = setInterval(updateMeetingTimer, 1000);
                
                // Start leadership metrics
                leadershipMetricsInterval = setInterval(updateLeadershipMetrics, 3000);
                
                // Update team feedback
                document.getElementById('team-feedback').textContent = 'Meeting started! Begin by setting the agenda and establishing your leadership presence.';
                
                // Update scenario
                const scenarios = [
                    'The team needs to decide on the project timeline. Some members want to rush, others prefer a careful approach.',
                    'Budget constraints have been announced. You need to reallocate resources and maintain team morale.',
                    'A key team member is underperforming. Address this sensitively while maintaining team dynamics.',
                    'The client has requested major changes. Guide the team through this challenging pivot.',
                    'Two departments are in conflict over priorities. Facilitate a resolution as the leader.'
                ];
                
                const randomScenario = scenarios[Math.floor(Math.random() * scenarios.length)];
                document.getElementById('leadership-scenario').textContent = randomScenario;
                
            } else {
                endMeeting();
            }
        }
        
        function endMeeting() {
            meetingActive = false;
            const meetingBtn = document.getElementById('meeting-btn');
            meetingBtn.textContent = 'üöÄ Start Meeting';
            meetingBtn.style.background = 'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)';
            
            if (meetingTimer) {
                clearInterval(meetingTimer);
                meetingTimer = null;
            }
            
            if (leadershipMetricsInterval) {
                clearInterval(leadershipMetricsInterval);
                leadershipMetricsInterval = null;
            }
            
            document.getElementById('team-feedback').textContent = 'Meeting ended. Great leadership! Click "View Results" to see your performance analysis.';
        }
        
        function updateMeetingTimer() {
            const elapsed = Math.floor((Date.now() - meetingStartTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            const timeStr = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            const timerElement = document.getElementById('meeting-time');
            if (timerElement) timerElement.textContent = timeStr;
        }
        
        function updateLeadershipMetrics() {
            if (!meetingActive) return;
            
            const elapsed = (Date.now() - meetingStartTime) / 1000;
            const improvement = Math.min(elapsed / 120, 1); // Improve over 2 minutes
            
            // Simulate realistic leadership metrics
            const decision = Math.min(40 + Math.random() * 35 + improvement * 30, 95);
            const harmony = Math.min(50 + Math.random() * 30 + improvement * 25, 90);
            const influence = Math.min(45 + Math.random() * 35 + improvement * 25, 88);
            const communication = Math.min(55 + Math.random() * 25 + improvement * 30, 92);
            
            updateLeadershipMetric('decision', decision);
            updateLeadershipMetric('harmony', harmony);
            updateLeadershipMetric('influence', influence);
            updateLeadershipMetric('communication', communication);
            
            // Update team feedback based on performance
            updateLeadershipFeedback(decision, harmony, influence, communication);
        }
        
        function updateLeadershipMetric(metricName, value) {
            const scoreElement = document.getElementById(`${metricName}-score`);
            const barElement = document.getElementById(`${metricName}-bar`);
            
            if (scoreElement && barElement) {
                const displayValue = Math.round(value);
                scoreElement.textContent = `${displayValue}%`;
                barElement.style.width = `${displayValue}%`;
            }
        }
        
        function makeDecision() {
            if (!meetingActive) {
                showMessage('üöÄ Start a meeting first to practice decision making!');
                return;
            }
            
            const decisions = [
                'You decide to proceed with the aggressive timeline to meet client expectations.',
                'You choose the conservative approach to ensure quality and team well-being.',
                'You propose a hybrid solution that balances speed with quality.',
                'You delegate the decision to the team after providing clear guidelines.',
                'You decide to gather more information before making the final call.'
            ];
            
            const decision = decisions[Math.floor(Math.random() * decisions.length)];
            document.getElementById('team-feedback').textContent = `Decision made: ${decision}`;
            
            // Boost decision making score
            const currentScore = parseInt(document.getElementById('decision-score').textContent) || 0;
            updateLeadershipMetric('decision', Math.min(currentScore + 15, 100));
        }
        
        function resolveConflict() {
            if (!meetingActive) {
                showMessage('üöÄ Start a meeting first to practice conflict resolution!');
                return;
            }
            
            const resolutions = [
                'You facilitate a discussion where both parties express their concerns and find common ground.',
                'You mediate the conflict by focusing on shared goals and team objectives.',
                'You address the underlying issues causing the conflict with empathy and understanding.',
                'You establish clear boundaries and expectations to prevent future conflicts.',
                'You bring in a neutral perspective to help resolve the disagreement.'
            ];
            
            const resolution = resolutions[Math.floor(Math.random() * resolutions.length)];
            document.getElementById('team-feedback').textContent = `Conflict resolved: ${resolution}`;
            
            // Boost harmony score
            const currentScore = parseInt(document.getElementById('harmony-score').textContent) || 0;
            updateLeadershipMetric('harmony', Math.min(currentScore + 20, 100));
        }
        
        function motivateTeam() {
            if (!meetingActive) {
                showMessage('üöÄ Start a meeting first to practice team motivation!');
                return;
            }
            
            const motivations = [
                'You inspire the team by highlighting their past successes and capabilities.',
                'You set clear, achievable goals that energize and focus the team.',
                'You recognize individual contributions and celebrate team achievements.',
                'You share your vision and help the team see the bigger picture.',
                'You provide support and resources to help the team overcome challenges.'
            ];
            
            const motivation = motivations[Math.floor(Math.random() * motivations.length)];
            document.getElementById('team-feedback').textContent = `Team motivated: ${motivation}`;
            
            // Boost influence score
            const currentScore = parseInt(document.getElementById('influence-score').textContent) || 0;
            updateLeadershipMetric('influence', Math.min(currentScore + 18, 100));
        }
        
        // Team Leadership AI Functions
        let currentLeadershipScenario = '';
        let leadershipActions = [];
        
        // Generate AI-powered leadership scenario
        async function generateLeadershipScenario() {
            if (!groqApiKey) {
                showMessage('üîë Please set up your Groq API key first to use AI-powered scenarios.');
                return;
            }
            
            updateLeadershipFeedback('ü§ñ Generating a structured leadership scenario for you...');
            
            const messages = [
                {
                    role: 'system',
                    content: `You are an AI Leadership Scenario Generator for team leadership training. Create a realistic, engaging, and challenging scenario in the following structured format:

1. **Scenario Title**: Short, catchy name.
2. **Background**: 3‚Äì5 sentences describing the organization, team roles, and project context.
3. **Current Situation**: Detailed explanation of what is happening, including personalities, conflicts, and pressures.
4. **Leadership Challenge**: A clear list of 3‚Äì5 leadership issues the team leader must solve.
5. **Actionable Questions**: Specific, open-ended questions the trainee must answer to address the challenges.
6. **Deliverables**: A concise bullet list of what the trainee must produce (e.g., conflict resolution plan, communication strategy, decision-making approach, morale-boosting actions).

Requirements:
- Make the scenario specific and believable (include realistic deadlines, roles, and conflicts)
- Use clear headings and bullet points for readability
- Keep total length between 250‚Äì350 words
- Avoid generic corporate jargon ‚Äî make it feel real and relatable
- Include specific names, roles, and realistic workplace dynamics`
                },
                {
                    role: 'user',
                    content: 'Generate a challenging leadership scenario for team leadership training. Make it realistic with specific details about team dynamics, conflicts, and leadership challenges that require immediate attention.'
                }
            ];
            
            const scenario = await callGroqAPI(messages, 0.8);
            
            if (scenario) {
                currentLeadershipScenario = scenario.trim();
                showStructuredScenario(currentLeadershipScenario);
                updateLeadershipFeedback(`üéØ New structured leadership scenario generated! Review the challenge details and begin leading your team through this situation.`);
                addToLeadershipConversation('üé≤ AI Scenario Generator', `Generated structured scenario with specific challenges and deliverables`);
            }
        }
        
        // Show structured scenario in a modal
        function showStructuredScenario(scenario) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.9);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
                backdrop-filter: blur(10px);
                padding: 2rem;
            `;
            
            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #1f2937 0%, #111827 100%); border-radius: 20px; padding: 3rem; max-width: 900px; max-height: 80vh; overflow-y: auto; color: white; border: 2px solid #8b5cf6;">
                    <h3 style="font-size: 2rem; margin-bottom: 2rem; color: #8b5cf6; text-align: center;">üé≤ AI Leadership Scenario</h3>
                    <div style="font-size: 1rem; line-height: 1.6; margin-bottom: 2rem; white-space: pre-line;">${scenario}</div>
                    <div style="text-align: center; display: flex; gap: 1rem; justify-content: center;">
                        <button onclick="acceptScenario(); closeScenarioModal()" style="
                            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                            color: white;
                            border: none;
                            padding: 1rem 2rem;
                            border-radius: 15px;
                            cursor: pointer;
                            font-weight: 600;
                            font-size: 1rem;
                        ">üöÄ Start This Scenario</button>
                        <button onclick="generateLeadershipScenario(); closeScenarioModal()" style="
                            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
                            color: white;
                            border: none;
                            padding: 1rem 2rem;
                            border-radius: 15px;
                            cursor: pointer;
                            font-weight: 600;
                            font-size: 1rem;
                        ">üé≤ Generate New</button>
                        <button onclick="closeScenarioModal()" style="
                            background: rgba(255, 255, 255, 0.1);
                            color: white;
                            border: 1px solid rgba(255, 255, 255, 0.2);
                            padding: 1rem 2rem;
                            border-radius: 15px;
                            cursor: pointer;
                        ">‚ùå Cancel</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            window.currentScenarioModal = modal;
        }
        
        // Accept the generated scenario
        function acceptScenario() {
            document.getElementById('leadership-scenario').textContent = currentLeadershipScenario;
            updateLeadershipFeedback('üéØ Scenario accepted! You are now the team leader in this challenging situation. Use the leadership controls to navigate through the scenario.');
            addToLeadershipConversation('‚úÖ Scenario Accepted', 'Ready to lead through this structured challenge');
            
            // Auto-start meeting if not already active
            if (!meetingActive) {
                setTimeout(() => {
                    if (confirm('üöÄ Would you like to start the leadership meeting now to begin addressing this scenario?')) {
                        startMeeting();
                    }
                }, 1000);
            }
        }
        
        // Close scenario modal
        function closeScenarioModal() {
            if (window.currentScenarioModal && document.body.contains(window.currentScenarioModal)) {
                document.body.removeChild(window.currentScenarioModal);
                window.currentScenarioModal = null;
            }
        }
        
        // Analyze leadership decision with AI
        async function analyzeLeadershipDecision(action, context) {
            if (!groqApiKey) return;
            
            const messages = [
                {
                    role: 'system',
                    content: 'You are an expert leadership coach. Analyze leadership decisions and provide constructive feedback on effectiveness, team impact, and alternative approaches. Be specific and actionable.'
                },
                {
                    role: 'user',
                    content: `Analyze this leadership decision: "${action}" in the context of: "${context}". Provide feedback on effectiveness and suggest improvements.`
                }
            ];
            
            const analysis = await callGroqAPI(messages, 0.7);
            
            if (analysis) {
                updateLeadershipFeedback(analysis);
                addToLeadershipConversation('üß† Decision Analysis', analysis);
            }
        }
        
        // Get comprehensive leadership feedback
        async function getLeadershipFeedback() {
            if (!groqApiKey) {
                showMessage('üîë Please set up your Groq API key first to get AI feedback.');
                return;
            }
            
            if (leadershipActions.length === 0) {
                showMessage('üë• Take some leadership actions first (start meeting, make decisions, resolve conflicts) so I can analyze your leadership style!');
                return;
            }
            
            updateLeadershipFeedback('ü§ñ Analyzing your leadership performance and style...');
            
            const performanceData = {
                scenario: currentLeadershipScenario,
                actions: leadershipActions,
                metrics: {
                    decision: parseInt(document.getElementById('decision-score')?.textContent || '0'),
                    harmony: parseInt(document.getElementById('harmony-score')?.textContent || '0'),
                    influence: parseInt(document.getElementById('influence-score')?.textContent || '0'),
                    communication: parseInt(document.getElementById('communication-score')?.textContent || '0')
                },
                meetingDuration: Math.floor((Date.now() - meetingStartTime) / 1000)
            };
            
            const messages = [
                {
                    role: 'system',
                    content: 'You are an expert leadership coach. Provide comprehensive feedback on leadership performance including strengths, areas for improvement, leadership style analysis, and specific development recommendations.'
                },
                {
                    role: 'user',
                    content: `Analyze this leadership session: ${JSON.stringify(performanceData)}. Provide detailed feedback on leadership effectiveness and development areas.`
                }
            ];
            
            const feedback = await callGroqAPI(messages, 0.7);
            
            if (feedback) {
                updateLeadershipFeedback(feedback);
                addToLeadershipConversation('üéØ Comprehensive Analysis', feedback);
                showLeadershipFeedbackModal(feedback);
            }
        }
        
        // Generate AI team member responses
        async function generateTeamResponse(leadershipAction) {
            if (!groqApiKey) return;
            
            const messages = [
                {
                    role: 'system',
                    content: 'You are simulating team member responses to leadership actions. Generate realistic, varied team reactions that reflect different personality types and perspectives. Keep responses brief but authentic.'
                },
                {
                    role: 'user',
                    content: `The leader just took this action: "${leadershipAction}" in the scenario: "${currentLeadershipScenario}". How would different team members respond?`
                }
            ];
            
            const response = await callGroqAPI(messages, 0.8);
            
            if (response) {
                updateLeadershipFeedback(`Team Response: ${response}`);
                addToLeadershipConversation('üë• Team Reaction', response);
                
                // Update avatar reactions based on AI response
                updateAvatarReactions(response);
            }
        }
        
        // Update avatar reactions based on AI analysis
        function updateAvatarReactions(aiResponse) {
            const avatars = document.querySelectorAll('#team-avatars-leadership > div');
            const positiveWords = ['agree', 'support', 'positive', 'good', 'excellent', 'approve'];
            const negativeWords = ['disagree', 'concern', 'worried', 'negative', 'problem', 'issue'];
            
            const isPositive = positiveWords.some(word => aiResponse.toLowerCase().includes(word));
            const isNegative = negativeWords.some(word => aiResponse.toLowerCase().includes(word));
            
            avatars.forEach((avatar, index) => {
                if (isPositive && Math.random() > 0.3) {
                    avatar.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                    avatar.dataset.state = 'agreeing';
                } else if (isNegative && Math.random() > 0.4) {
                    avatar.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
                    avatar.dataset.state = 'disagreeing';
                } else if (Math.random() > 0.6) {
                    avatar.style.background = 'linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)';
                    avatar.dataset.state = 'speaking';
                }
            });
        }
        
        // Add message to leadership conversation
        function addToLeadershipConversation(speaker, message) {
            const conversationElement = document.getElementById('leadership-conversation');
            if (!conversationElement) return;
            
            const messageDiv = document.createElement('div');
            messageDiv.style.cssText = `
                margin-bottom: 1rem;
                padding: 0.5rem;
                background: rgba(255,255,255,0.05);
                border-radius: 8px;
                border-left: 3px solid ${speaker.includes('ü§ñ') || speaker.includes('üß†') ? '#10b981' : '#3b82f6'};
            `;
            
            messageDiv.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 0.25rem; font-size: 0.75rem; opacity: 0.8;">${speaker}</div>
                <div style="font-size: 0.8rem; line-height: 1.3;">${message}</div>
            `;
            
            conversationElement.appendChild(messageDiv);
            conversationElement.scrollTop = conversationElement.scrollHeight;
            
            // Keep only last 8 messages
            while (conversationElement.children.length > 8) {
                conversationElement.removeChild(conversationElement.firstChild);
            }
        }
        
        // Show detailed leadership feedback modal
        function showLeadershipFeedbackModal(feedback) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.9);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
                backdrop-filter: blur(10px);
                padding: 2rem;
            `;
            
            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #1f2937 0%, #111827 100%); border-radius: 20px; padding: 3rem; max-width: 800px; max-height: 80vh; overflow-y: auto; color: white; border: 2px solid #3b82f6;">
                    <h3 style="font-size: 2rem; margin-bottom: 2rem; color: #3b82f6; text-align: center;">üë• AI Leadership Analysis</h3>
                    <div style="font-size: 1rem; line-height: 1.6; margin-bottom: 2rem; white-space: pre-line;">${feedback}</div>
                    <div style="text-align: center;">
                        <button onclick="closeLeadershipModal()" style="
                            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
                            color: white;
                            border: none;
                            padding: 1rem 2rem;
                            border-radius: 15px;
                            cursor: pointer;
                            font-weight: 600;
                            font-size: 1rem;
                        ">‚úÖ Continue Leading</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            window.currentLeadershipModal = modal;
        }
        
        // Close leadership modal
        function closeLeadershipModal() {
            if (window.currentLeadershipModal && document.body.contains(window.currentLeadershipModal)) {
                document.body.removeChild(window.currentLeadershipModal);
                window.currentLeadershipModal = null;
            }
        }
        
        // Update leadership feedback display (FIXED)
        function updateLeadershipFeedback(message) {
            const feedbackElement = document.getElementById('team-feedback');
            if (feedbackElement && message && typeof message === 'string') {
                // Only update if message is a valid string and not a number
                if (!isNaN(parseFloat(message)) && isFinite(message)) {
                    // If it's a number, don't display it - use default message instead
                    feedbackElement.textContent = 'ü§ñ AI Leadership Coach is analyzing your performance...';
                } else {
                    feedbackElement.textContent = message;
                }
            }
        }
        
        // Leadership API Key Management
        function saveLeadershipApiKey() {
            const keyInput = document.getElementById('leadership-groq-api-key');
            const key = keyInput.value.trim();
            
            if (key) {
                groqApiKey = key;
                localStorage.setItem('groq-api-key', key);
                document.getElementById('leadership-api-key-section').style.display = 'none';
                showMessage('‚úÖ Groq API key saved! AI leadership coaching is now enabled.');
                updateLeadershipFeedback('ü§ñ AI Leadership Coach activated! I\'m ready to analyze your leadership style and provide expert coaching.');
                addToLeadershipConversation('üîë API Setup', 'AI Leadership Coach is now active and ready to provide intelligent feedback');
            } else {
                showMessage('‚ùå Please enter a valid API key.');
            }
        }
        
        // Load API key for leadership training
        function loadLeadershipApiKey() {
            // Try to load from environment variables first
            const envApiKey = process?.env?.REACT_APP_GROQ_API_KEY || window?.ENV?.REACT_APP_GROQ_API_KEY;
            
            // Then try localStorage
            const savedKey = localStorage.getItem('groq-api-key');
            
            if (envApiKey && envApiKey !== 'your_groq_api_key_here') {
                groqApiKey = envApiKey;
                document.getElementById('leadership-api-key-section').style.display = 'none';
                updateLeadershipFeedback('ü§ñ AI Leadership Coach ready! API key loaded from environment configuration.');
                addToLeadershipConversation('üîë API Setup', 'AI Leadership Coach loaded from environment');
            } else if (savedKey) {
                groqApiKey = savedKey;
                document.getElementById('leadership-api-key-section').style.display = 'none';
                updateLeadershipFeedback('ü§ñ AI Leadership Coach ready! I\'ll analyze your leadership decisions and provide expert coaching.');
                addToLeadershipConversation('üîë API Setup', 'AI Leadership Coach is active and ready');
            } else {
                // Show API key input section
                updateLeadershipFeedback('üîë Please configure your Groq API key to enable AI-powered leadership coaching. Get a free key at console.groq.com');
            }
        }
        
        function goToModule(moduleId) {
            console.log('Navigating to module:', moduleId);
            
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show the requested page
            const targetPage = document.getElementById(moduleId);
            if (targetPage) {
                targetPage.classList.add('active');
                console.log('Successfully navigated to:', moduleId);
                
                // Scroll to top
                window.scrollTo(0, 0);
            } else {
                console.error('Module not found:', moduleId);
                alert('Module not found: ' + moduleId);
            }
        }
        
        function startTraining(moduleId) {
            // Navigate to the actual training interface
            const trainingPageId = moduleId + '-training';
            goToModule(trainingPageId);
            
            // Initialize the training environment
            if (moduleId === 'public-speaking') {
                initializeAudience();
                initializeSpeechRecognition();
                loadApiKey();
                
                // Show some example topics if no API key
                if (!groqApiKey) {
                    const exampleTopics = [
                        "The importance of lifelong learning in the digital age",
                        "How social media has changed human communication", 
                        "The role of artificial intelligence in our daily lives",
                        "Why failure is essential for personal growth",
                        "The impact of remote work on company culture",
                        "Building resilience in times of uncertainty",
                        "The power of storytelling in business",
                        "Sustainable living in modern society"
                    ];
                    const randomTopic = exampleTopics[Math.floor(Math.random() * exampleTopics.length)];
                    document.getElementById('current-topic').textContent = randomTopic;
                    currentTopic = randomTopic;
                }
                
            } else if (moduleId === 'team-leadership') {
                initializeTeamAvatars();
                loadLeadershipApiKey();
                
            } else if (moduleId === 'collaboration') {
                initializeCollaborationTeam();
            }
        }
        
        // Initialize speech recognition
        function initializeSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                speechRecognition = new SpeechRecognition();
                speechRecognition.continuous = true;
                speechRecognition.interimResults = true;
                speechRecognition.lang = 'en-US';
                
                speechRecognition.onresult = function(event) {
                    let transcript = '';
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        if (event.results[i].isFinal) {
                            transcript += event.results[i][0].transcript + ' ';
                        }
                    }
                    
                    if (transcript.trim()) {
                        speechTranscript += transcript;
                        
                        // Analyze with AI every 50 words
                        if (speechTranscript.split(' ').length % 50 === 0) {
                            analyzeWithGroq(transcript);
                        }
                    }
                };
                
                speechRecognition.onerror = function(event) {
                    console.log('Speech recognition error:', event.error);
                    if (event.error === 'not-allowed') {
                        updateAIFeedback('üé§ Microphone access denied. Please allow microphone access to enable speech analysis.');
                    }
                };
                
                speechRecognition.onend = function() {
                    // Restart if still training
                    if (isTraining) {
                        setTimeout(() => {
                            if (isTraining) speechRecognition.start();
                        }, 100);
                    }
                };
            }
        }
        
        // Update pattern displays
        function updatePatternDisplays() {
            document.getElementById('filler-count').textContent = speechPatterns.fillerWords;
            
            const paceText = speechPatterns.averagePace > 150 ? 'Fast' : 
                           speechPatterns.averagePace < 100 ? 'Slow' : 'Normal';
            document.getElementById('pace-display').textContent = paceText;
            
            const confidenceText = currentEmotionalState === 'confident' ? 'High' :
                                 currentEmotionalState === 'nervous' ? 'Building' : 'Moderate';
            document.getElementById('confidence-display').textContent = confidenceText;
        }
        
        // Enhanced speech pattern analysis
        function analyzeSpeechPatterns(transcript) {
            if (!transcript) return;
            
            const words = transcript.split(' ');
            const fillerWords = ['um', 'uh', 'like', 'you know', 'so', 'actually', 'basically', 'literally', 'totally'];
            let fillerCount = 0;
            
            words.forEach(word => {
                const cleanWord = word.toLowerCase().replace(/[.,!?]/g, '');
                if (fillerWords.includes(cleanWord)) {
                    fillerCount++;
                }
            });
            
            speechPatterns.fillerWords += fillerCount;
            speechPatterns.averagePace = Math.round(words.length * 60 / ((Date.now() - sessionStartTime) / 1000));
            
            // Provide real-time pattern feedback
            if (fillerCount > 3) {
                addToConversation('üìä Pattern Alert', `‚ö†Ô∏è High filler word usage detected. Try pausing instead of using "um" or "uh".`);
            }
            
            if (speechPatterns.averagePace > 180) {
                addToConversation('üìä Pace Alert', 'üèÉ Speaking quite fast! Consider slowing down for better clarity.');
            } else if (speechPatterns.averagePace < 80) {
                addToConversation('üìä Pace Alert', 'üêå Speaking slowly. Try to increase your pace slightly for better engagement.');
            }
        }
        
        // Set and save coaching level
        function setCoachingLevel(level) {
            adaptiveCoachingLevel = level;
            localStorage.setItem('virtuprep-coaching-level', level);
            document.getElementById('coaching-level').textContent = level.charAt(0).toUpperCase() + level.slice(1);
            
            const messages = {
                beginner: 'üìö Coaching level set to Beginner. I\'ll provide gentle guidance and focus on building your confidence.',
                intermediate: 'üéì Coaching level set to Intermediate. I\'ll give you more detailed feedback and challenges.',
                advanced: 'üèÜ Coaching level set to Advanced. I\'ll provide expert-level analysis and push you to excel.'
            };
            
            updateAIFeedback(messages[level]);
            addToConversation('üéØ Coaching Level', `Set to ${level.toUpperCase()}`);
        }
        
        // Public Speaking Training Functions
        function initializeAudience() {
            const audienceGrid = document.getElementById('audience-grid');
            if (!audienceGrid) return;
            
            audienceGrid.innerHTML = '';
            audienceMembers = [];
            
            for (let i = 0; i < 32; i++) {
                const member = document.createElement('div');
                member.style.cssText = `
                    width: 30px;
                    height: 40px;
                    border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
                    background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
                    transition: all 0.5s ease;
                    cursor: pointer;
                `;
                member.onclick = () => toggleAudienceMember(member);
                audienceGrid.appendChild(member);
                audienceMembers.push(member);
            }
        }
        
        function toggleAudienceMember(member) {
            const colors = [
                'linear-gradient(135deg, #10b981 0%, #059669 100%)', // positive
                'linear-gradient(135deg, #6b7280 0%, #4b5563 100%)', // neutral
                'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)'  // negative
            ];
            const currentIndex = colors.findIndex(color => member.style.background.includes(color.split('(')[1].split(',')[0]));
            const nextIndex = (currentIndex + 1) % colors.length;
            member.style.background = colors[nextIndex];
        }
        
        function startSpeaking() {
            const speakBtn = document.getElementById('speak-btn');
            
            if (!isTraining) {
                isTraining = true;
                sessionStartTime = Date.now();
                speechTranscript = ''; // Reset transcript
                speakBtn.textContent = 'üî¥ Stop Speaking';
                speakBtn.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                
                // Start session timer
                sessionTimer = setInterval(updateSessionTimer, 1000);
                
                // Start metrics simulation
                metricsInterval = setInterval(updateMetrics, 2000);
                
                // Start speech recognition if available
                if (speechRecognition) {
                    speechRecognition.start();
                }
                
                // Update AI feedback
                if (currentTopic) {
                    updateAIFeedback(`üé§ Excellent! You're now speaking about "${currentTopic}". I'm listening and will provide feedback as you speak.`);
                } else {
                    updateAIFeedback('üé§ Great! You\'re now speaking. I\'m listening and analyzing your presentation in real-time.');
                }
                
                // Schedule AI interactions
                setTimeout(() => {
                    if (isTraining) generateAIQuestion();
                }, Math.random() * 30000 + 20000); // Random question after 20-50 seconds
                
            } else {
                stopSpeaking();
            }
        }
        
        function stopSpeaking() {
            isTraining = false;
            const speakBtn = document.getElementById('speak-btn');
            speakBtn.textContent = 'üé§ Start Speaking';
            speakBtn.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
            
            // Clear all intervals
            if (sessionTimer) {
                clearInterval(sessionTimer);
                sessionTimer = null;
            }
            
            if (metricsInterval) {
                clearInterval(metricsInterval);
                metricsInterval = null;
            }
            
            // Stop speech recognition
            if (speechRecognition) {
                speechRecognition.stop();
            }
            
            updateAIFeedback('üé§ Session paused. Click "Get AI Feedback" for a comprehensive analysis of your speech, or "Start Speaking" to continue.');
            
            // Offer immediate feedback if there's speech content
            if (speechTranscript.trim()) {
                setTimeout(() => {
                    if (confirm('ü§ñ Would you like me to analyze your speech performance?')) {
                        getAIFeedback();
                    }
                }, 1000);
            }
        }
        
        function updateSessionTimer() {
            const elapsed = Math.floor((Date.now() - sessionStartTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            const timeStr = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            const timerElement = document.getElementById('session-time');
            if (timerElement) timerElement.textContent = timeStr;
        }
        
        function updateMetrics() {
            if (!isTraining) return;
            
            const elapsed = (Date.now() - sessionStartTime) / 1000;
            const improvement = Math.min(elapsed / 60, 1);
            
            // Simulate realistic metrics with gradual improvement
            const clarity = Math.min(50 + Math.random() * 30 + improvement * 25, 95);
            const volume = Math.min(40 + Math.random() * 40 + improvement * 20, 90);
            const pace = Math.min(100 + Math.random() * 50 + improvement * 30, 180);
            const engagement = Math.min(45 + Math.random() * 35 + improvement * 25, 88);
            
            updateMetric('clarity', clarity);
            updateMetric('volume', volume);
            updateMetric('pace', pace, 'WPM');
            updateMetric('engagement', engagement);
            
            // Update audience reactions
            updateAudienceReactions(engagement);
            
            // Update live coaching
            updateLiveCoaching(clarity, volume, engagement);
        }
        
        function updateMetric(metricName, value, suffix = '%') {
            const scoreElement = document.getElementById(`${metricName}-score`);
            const barElement = document.getElementById(`${metricName}-bar`);
            
            if (scoreElement && barElement) {
                const displayValue = suffix === 'WPM' ? Math.round(value) : Math.round(value);
                scoreElement.textContent = `${displayValue}${suffix}`;
                
                const percentage = suffix === 'WPM' ? Math.min(value / 180 * 100, 100) : value;
                barElement.style.width = `${percentage}%`;
            }
        }
        
        function updateAudienceReactions(engagement) {
            audienceMembers.forEach(member => {
                const random = Math.random() * 100;
                if (engagement > 70 && random < 20) {
                    member.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                } else if (engagement < 40 && random < 15) {
                    member.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
                } else if (random < 5) {
                    member.style.background = 'linear-gradient(135deg, #6b7280 0%, #4b5563 100%)';
                }
            });
        }
        
        function updateLiveCoaching(clarity, volume, engagement) {
            const coachingElement = document.getElementById('live-coaching');
            if (!coachingElement) return;
            
            let message = '';
            if (clarity < 60) {
                message = 'üó£Ô∏è Speak more clearly and articulate your words better.';
            } else if (volume < 50) {
                message = 'üîä Project your voice more - the audience needs to hear you clearly.';
            } else if (engagement < 50) {
                message = 'üë• Try to engage more with your audience - make eye contact and vary your tone.';
            } else if (engagement > 80) {
                message = 'üåü Excellent! Your audience is highly engaged. Keep up the great work!';
            } else {
                message = 'üëç Good performance! Continue building momentum with your presentation.';
            }
            
            coachingElement.textContent = message;
        }
        
        function triggerChallenge() {
            const challenges = [
                {
                    title: '‚ö° Unexpected Question!',
                    description: 'An audience member asks: "Can you provide more specific data to support your main point?"',
                    options: [
                        'Acknowledge and provide additional details',
                        'Redirect to Q&A session at the end',
                        'Ask the audience for their thoughts first'
                    ]
                },
                {
                    title: 'üîß Technical Difficulty!',
                    description: 'The microphone stops working during your presentation. What do you do?',
                    options: [
                        'Continue speaking louder without the mic',
                        'Pause and wait for technical support',
                        'Move closer to the audience and continue'
                    ]
                }
            ];
            
            const challenge = challenges[Math.floor(Math.random() * challenges.length)];
            showChallengeModal(challenge);
        }
        
        function triggerRandomChallenge() {
            if (isTraining) {
                triggerChallenge();
                // Schedule next challenge
                setTimeout(triggerRandomChallenge, Math.random() * 30000 + 20000);
            }
        }
        
        function showChallengeModal(challenge) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
                backdrop-filter: blur(10px);
            `;
            
            modal.innerHTML = `
                <div style="background: linear-gradient(135deg, #1f2937 0%, #111827 100%); border-radius: 20px; padding: 3rem; max-width: 600px; text-align: center; color: white;">
                    <h3 style="font-size: 2rem; margin-bottom: 1rem; color: #f59e0b;">${challenge.title}</h3>
                    <p style="font-size: 1.1rem; margin-bottom: 2rem; line-height: 1.6; opacity: 0.9;">${challenge.description}</p>
                    <div style="display: flex; flex-direction: column; gap: 1rem; margin-bottom: 2rem;">
                        ${challenge.options.map((option, index) => `
                            <button onclick="selectChallengeOption(${index}, '${option}')" style="
                                background: rgba(255, 255, 255, 0.1);
                                border: 1px solid rgba(255, 255, 255, 0.2);
                                color: white;
                                padding: 1rem 1.5rem;
                                border-radius: 15px;
                                cursor: pointer;
                                transition: all 0.3s ease;
                                text-align: left;
                            " onmouseover="this.style.background='rgba(255, 255, 255, 0.2)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'">
                                ${option}
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            window.currentChallengeModal = modal;
        }
        
        function selectChallengeOption(index, option) {
            if (window.currentChallengeModal) {
                document.body.removeChild(window.currentChallengeModal);
                window.currentChallengeModal = null;
            }
            
            const responses = [
                'Excellent choice! Your quick thinking shows strong leadership.',
                'Good decision! You handled that challenge professionally.',
                'Interesting approach! That shows creative problem-solving.'
            ];
            
            const response = responses[Math.min(index, 2)];
            showMessage(response);
        }
        
        function showResults() {
            const clarity = parseInt(document.getElementById('clarity-score')?.textContent || '0');
            const volume = parseInt(document.getElementById('volume-score')?.textContent || '0');
            const engagement = parseInt(document.getElementById('engagement-score')?.textContent || '0');
            
            const overallScore = Math.round((clarity + volume + engagement) / 3);
            
            showMessage(`üìä Session Results:\n\nüèÜ Overall Score: ${overallScore}%\nüó£Ô∏è Speech Clarity: ${clarity}%\nüîä Volume Level: ${volume}%\nüéØ Audience Engagement: ${engagement}%\n\nGreat job! Keep practicing to improve your scores.`);
        }
        
        function showMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0, 0, 0, 0.9);
                color: white;
                padding: 2rem;
                border-radius: 15px;
                z-index: 3000;
                font-size: 1.1rem;
                text-align: center;
                max-width: 500px;
                backdrop-filter: blur(10px);
                white-space: pre-line;
            `;
            messageDiv.textContent = message;
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                if (document.body.contains(messageDiv)) {
                    document.body.removeChild(messageDiv);
                }
            }, 4000);
        }
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('VirtuPrep loaded successfully!');
        });
    </script>
</body>
</html>
